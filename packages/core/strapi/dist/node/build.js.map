{"version":3,"file":"build.js","sources":["../../src/node/build.ts"],"sourcesContent":["import * as tsUtils from '@strapi/typescript-utils';\r\nimport type { CLIContext } from '../cli/types';\r\nimport { checkRequiredDependencies } from './core/dependencies';\r\nimport { getTimer, prettyTime } from './core/timer';\r\nimport { createBuildContext } from './create-build-context';\r\nimport { writeStaticClientFiles } from './staticFiles';\r\n\r\ninterface BuildOptions extends CLIContext {\r\n  /**\r\n   * Which bundler to use for building.\r\n   *\r\n   * @default webpack\r\n   */\r\n  bundler?: 'webpack' | 'vite';\r\n  /**\r\n   * Minify the output\r\n   *\r\n   * @default true\r\n   */\r\n  minify?: boolean;\r\n  /**\r\n   * Generate sourcemaps â€“ useful for debugging bugs in the admin panel UI.\r\n   */\r\n  sourcemaps?: boolean;\r\n  /**\r\n   * Print stats for build\r\n   */\r\n  stats?: boolean;\r\n}\r\n\r\n/**\r\n * @example `$ strapi build`\r\n *\r\n * @description Builds the admin panel of the strapi application.\r\n */\r\nconst build = async ({ logger, cwd, tsconfig, ...options }: BuildOptions) => {\r\n  const timer = getTimer();\r\n\r\n  const { didInstall } = await checkRequiredDependencies({ cwd, logger }).catch((err) => {\r\n    logger.error(err.message);\r\n    process.exit(1);\r\n  });\r\n\r\n  if (didInstall) {\r\n    return;\r\n  }\r\n\r\n  if (tsconfig?.config) {\r\n    timer.start('compilingTS');\r\n    const compilingTsSpinner = logger.spinner(`Compiling TS`).start();\r\n\r\n    tsUtils.compile(cwd, { configOptions: { ignoreDiagnostics: false } });\r\n\r\n    const compilingDuration = timer.end('compilingTS');\r\n    compilingTsSpinner.text = `Compiling TS (${prettyTime(compilingDuration)})`;\r\n    compilingTsSpinner.succeed();\r\n  }\r\n\r\n  timer.start('createBuildContext');\r\n  const contextSpinner = logger.spinner(`Building build context`).start();\r\n  console.log('');\r\n\r\n  const ctx = await createBuildContext({\r\n    cwd,\r\n    logger,\r\n    tsconfig,\r\n    options,\r\n  });\r\n\r\n  const contextDuration = timer.end('createBuildContext');\r\n  contextSpinner.text = `Building build context (${prettyTime(contextDuration)})`;\r\n  contextSpinner.succeed();\r\n\r\n  timer.start('buildAdmin');\r\n  const buildingSpinner = logger.spinner(`Building admin panel`).start();\r\n  console.log('');\r\n\r\n  try {\r\n    await writeStaticClientFiles(ctx);\r\n\r\n    if (ctx.bundler === 'webpack') {\r\n      const { build: buildWebpack } = await import('./webpack/build');\r\n      await buildWebpack(ctx);\r\n    } else if (ctx.bundler === 'vite') {\r\n      const { build: buildVite } = await import('./vite/build');\r\n      await buildVite(ctx);\r\n    }\r\n\r\n    const buildDuration = timer.end('buildAdmin');\r\n    buildingSpinner.text = `Building admin panel (${prettyTime(buildDuration)})`;\r\n    buildingSpinner.succeed();\r\n  } catch (err) {\r\n    buildingSpinner.fail();\r\n    throw err;\r\n  }\r\n};\r\n\r\nexport { build };\r\nexport type { BuildOptions };\r\n"],"names":["timer","getTimer","checkRequiredDependencies","tsUtils","prettyTime","createBuildContext","writeStaticClientFiles"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAmCM,MAAA,QAAQ,OAAO,EAAE,QAAQ,KAAK,UAAU,GAAG,cAA4B;AAC3E,QAAMA,UAAQC,MAAAA,SAAS;AAEvB,QAAM,EAAE,eAAe,MAAMC,uCAA0B,EAAE,KAAK,QAAQ,EAAE,MAAM,CAAC,QAAQ;AAC9E,WAAA,MAAM,IAAI,OAAO;AACxB,YAAQ,KAAK,CAAC;AAAA,EAAA,CACf;AAED,MAAI,YAAY;AACd;AAAA,EAAA;AAGF,MAAI,UAAU,QAAQ;AACpBF,YAAM,MAAM,aAAa;AACzB,UAAM,qBAAqB,OAAO,QAAQ,cAAc,EAAE,MAAM;AAExDG,uBAAA,QAAQ,KAAK,EAAE,eAAe,EAAE,mBAAmB,MAAA,GAAS;AAE9D,UAAA,oBAAoBH,QAAM,IAAI,aAAa;AACjD,uBAAmB,OAAO,iBAAiBI,MAAAA,WAAW,iBAAiB,CAAC;AACxE,uBAAmB,QAAQ;AAAA,EAAA;AAG7BJ,UAAM,MAAM,oBAAoB;AAChC,QAAM,iBAAiB,OAAO,QAAQ,wBAAwB,EAAE,MAAM;AACtE,UAAQ,IAAI,EAAE;AAER,QAAA,MAAM,MAAMK,sCAAmB;AAAA,IACnC;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD;AAEK,QAAA,kBAAkBL,QAAM,IAAI,oBAAoB;AACtD,iBAAe,OAAO,2BAA2BI,MAAAA,WAAW,eAAe,CAAC;AAC5E,iBAAe,QAAQ;AAEvBJ,UAAM,MAAM,YAAY;AACxB,QAAM,kBAAkB,OAAO,QAAQ,sBAAsB,EAAE,MAAM;AACrE,UAAQ,IAAI,EAAE;AAEV,MAAA;AACF,UAAMM,YAAAA,uBAAuB,GAAG;AAE5B,QAAA,IAAI,YAAY,WAAW;AAC7B,YAAM,EAAE,OAAO,iBAAiB,MAAM,QAAO,QAAA,EAAA,KAAA,MAAA,QAAA,oBAAiB,CAAA;AAC9D,YAAM,aAAa,GAAG;AAAA,IAAA,WACb,IAAI,YAAY,QAAQ;AACjC,YAAM,EAAE,OAAO,cAAc,MAAM,QAAO,QAAA,EAAA,KAAA,MAAA,QAAA,iBAAc,CAAA;AACxD,YAAM,UAAU,GAAG;AAAA,IAAA;AAGf,UAAA,gBAAgBN,QAAM,IAAI,YAAY;AAC5C,oBAAgB,OAAO,yBAAyBI,MAAAA,WAAW,aAAa,CAAC;AACzE,oBAAgB,QAAQ;AAAA,WACjB,KAAK;AACZ,oBAAgB,KAAK;AACf,UAAA;AAAA,EAAA;AAEV;;"}