{"version":3,"file":"index.js","sources":["../../server/src/constants.ts","../../server/src/utils/index.ts","../../server/src/migrations/index.ts","../../server/src/migrations/database/5.0.0-document-id-in-actions.ts","../../server/src/register.ts","../../server/src/middlewares/documents.ts","../../server/src/bootstrap.ts","../../server/src/destroy.ts","../../server/src/content-types/release/schema.ts","../../server/src/content-types/release/index.ts","../../server/src/content-types/release-action/schema.ts","../../server/src/content-types/release-action/index.ts","../../server/src/content-types/index.ts","../../server/src/services/release.ts","../../server/src/services/release-action.ts","../../server/src/services/validation.ts","../../server/src/services/scheduling.ts","../../server/src/services/settings.ts","../../server/src/services/index.ts","../../server/src/controllers/validation/release.ts","../../server/src/controllers/release.ts","../../server/src/controllers/validation/release-action.ts","../../server/src/controllers/release-action.ts","../../server/src/controllers/validation/settings.ts","../../server/src/controllers/settings.ts","../../server/src/controllers/index.ts","../../server/src/routes/release.ts","../../server/src/routes/release-action.ts","../../server/src/routes/settings.ts","../../server/src/routes/index.ts","../../server/src/index.ts"],"sourcesContent":["export const RELEASE_MODEL_UID = 'plugin::content-releases.release';\r\nexport const RELEASE_ACTION_MODEL_UID = 'plugin::content-releases.release-action';\r\n\r\nexport const ACTIONS = [\r\n  {\r\n    section: 'plugins',\r\n    displayName: 'Read',\r\n    uid: 'read',\r\n    pluginName: 'content-releases',\r\n  },\r\n  {\r\n    section: 'plugins',\r\n    displayName: 'Create',\r\n    uid: 'create',\r\n    pluginName: 'content-releases',\r\n  },\r\n  {\r\n    section: 'plugins',\r\n    displayName: 'Edit',\r\n    uid: 'update',\r\n    pluginName: 'content-releases',\r\n  },\r\n  {\r\n    section: 'plugins',\r\n    displayName: 'Delete',\r\n    uid: 'delete',\r\n    pluginName: 'content-releases',\r\n  },\r\n  {\r\n    section: 'plugins',\r\n    displayName: 'Publish',\r\n    uid: 'publish',\r\n    pluginName: 'content-releases',\r\n  },\r\n  {\r\n    section: 'plugins',\r\n    displayName: 'Remove an entry from a release',\r\n    uid: 'delete-action',\r\n    pluginName: 'content-releases',\r\n  },\r\n  {\r\n    section: 'plugins',\r\n    displayName: 'Add an entry to a release',\r\n    uid: 'create-action',\r\n    pluginName: 'content-releases',\r\n  },\r\n\r\n  // Settings\r\n  {\r\n    uid: 'settings.read',\r\n    section: 'settings',\r\n    displayName: 'Read',\r\n    category: 'content releases',\r\n    subCategory: 'options',\r\n    pluginName: 'content-releases',\r\n  },\r\n\r\n  {\r\n    uid: 'settings.update',\r\n    section: 'settings',\r\n    displayName: 'Edit',\r\n    category: 'content releases',\r\n    subCategory: 'options',\r\n    pluginName: 'content-releases',\r\n  },\r\n];\r\n\r\nexport const ALLOWED_WEBHOOK_EVENTS = {\r\n  RELEASES_PUBLISH: 'releases.publish',\r\n};\r\n","import type { UID, Data, Core } from '@strapi/types';\r\n\r\nimport type { SettingsService } from '../services/settings';\r\nimport type { ReleaseService } from '../services/release';\r\nimport type { ReleaseActionService } from '../services/release-action';\r\n\r\ntype Services = {\r\n  release: ReleaseService;\r\n  'release-validation': any;\r\n  scheduling: any;\r\n  'release-action': ReleaseActionService;\r\n  'event-manager': any;\r\n  settings: SettingsService;\r\n};\r\n\r\ninterface Action {\r\n  contentType: UID.ContentType;\r\n  documentId?: Data.DocumentID;\r\n  locale?: string;\r\n}\r\n\r\nexport const getService = <TName extends keyof Services>(\r\n  name: TName,\r\n  { strapi }: { strapi: Core.Strapi }\r\n): Services[TName] => {\r\n  return strapi.plugin('content-releases').service(name);\r\n};\r\n\r\nexport const getDraftEntryValidStatus = async (\r\n  { contentType, documentId, locale }: Action,\r\n  { strapi }: { strapi: Core.Strapi }\r\n) => {\r\n  const populateBuilderService = strapi.plugin('content-manager').service('populate-builder');\r\n  // @ts-expect-error - populateBuilderService should be a function but is returning service\r\n  const populate = await populateBuilderService(contentType).populateDeep(Infinity).build();\r\n\r\n  const entry = await getEntry({ contentType, documentId, locale, populate }, { strapi });\r\n\r\n  return isEntryValid(contentType, entry, { strapi });\r\n};\r\n\r\nexport const isEntryValid = async (\r\n  contentTypeUid: string,\r\n  entry: any,\r\n  { strapi }: { strapi: Core.Strapi }\r\n) => {\r\n  try {\r\n    // @TODO: When documents service has validateEntityCreation method, use it instead\r\n    await strapi.entityValidator.validateEntityCreation(\r\n      strapi.getModel(contentTypeUid as UID.ContentType),\r\n      entry,\r\n      undefined,\r\n      // @ts-expect-error - FIXME: entity here is unnecessary\r\n      entry\r\n    );\r\n\r\n    const workflowsService = strapi.plugin('review-workflows').service('workflows');\r\n    const workflow = await workflowsService.getAssignedWorkflow(contentTypeUid, {\r\n      populate: 'stageRequiredToPublish',\r\n    });\r\n\r\n    if (workflow?.stageRequiredToPublish) {\r\n      return entry.strapi_stage.id === workflow.stageRequiredToPublish.id;\r\n    }\r\n\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n};\r\n\r\nexport const getEntry = async (\r\n  {\r\n    contentType,\r\n    documentId,\r\n    locale,\r\n    populate,\r\n    status = 'draft',\r\n  }: Action & { status?: 'draft' | 'published'; populate: any },\r\n  { strapi }: { strapi: Core.Strapi }\r\n) => {\r\n  if (documentId) {\r\n    // Try to get an existing draft or published document\r\n    const entry = await strapi\r\n      .documents(contentType)\r\n      .findOne({ documentId, locale, populate, status });\r\n\r\n    // The document isn't published yet, but the action is to publish it, fetch the draft\r\n    if (status === 'published' && !entry) {\r\n      return strapi\r\n        .documents(contentType)\r\n        .findOne({ documentId, locale, populate, status: 'draft' });\r\n    }\r\n\r\n    return entry;\r\n  }\r\n\r\n  return strapi.documents(contentType).findFirst({ locale, populate, status });\r\n};\r\n\r\nexport const getEntryStatus = async (contentType: UID.ContentType, entry: Data.ContentType) => {\r\n  if (entry.publishedAt) {\r\n    return 'published';\r\n  }\r\n\r\n  const publishedEntry = await strapi.documents(contentType).findOne({\r\n    documentId: entry.documentId,\r\n    locale: entry.locale,\r\n    status: 'published',\r\n    fields: ['updatedAt'],\r\n  });\r\n\r\n  if (!publishedEntry) {\r\n    return 'draft';\r\n  }\r\n\r\n  const entryUpdatedAt = new Date(entry.updatedAt).getTime();\r\n  const publishedEntryUpdatedAt = new Date(publishedEntry.updatedAt).getTime();\r\n\r\n  if (entryUpdatedAt > publishedEntryUpdatedAt) {\r\n    return 'modified';\r\n  }\r\n\r\n  return 'published';\r\n};\r\n","import type { Schema, UID } from '@strapi/types';\r\nimport { contentTypes as contentTypesUtils, async } from '@strapi/utils';\r\nimport isEqual from 'lodash/isEqual';\r\n\r\nimport { difference, keys } from 'lodash';\r\nimport { RELEASE_ACTION_MODEL_UID, RELEASE_MODEL_UID } from '../constants';\r\nimport { getDraftEntryValidStatus, getService } from '../utils';\r\nimport { Release } from '../../../shared/contracts/releases';\r\nimport { ReleaseAction } from '../../../shared/contracts/release-actions';\r\n\r\ninterface Input {\r\n  oldContentTypes: Record<string, Schema.ContentType>;\r\n  contentTypes: Record<string, Schema.ContentType>;\r\n}\r\n\r\nexport async function deleteActionsOnDisableDraftAndPublish({\r\n  oldContentTypes,\r\n  contentTypes,\r\n}: Input) {\r\n  if (!oldContentTypes) {\r\n    return;\r\n  }\r\n\r\n  for (const uid in contentTypes) {\r\n    if (!oldContentTypes[uid]) {\r\n      continue;\r\n    }\r\n\r\n    const oldContentType = oldContentTypes[uid];\r\n    const contentType = contentTypes[uid];\r\n\r\n    if (\r\n      contentTypesUtils.hasDraftAndPublish(oldContentType) &&\r\n      !contentTypesUtils.hasDraftAndPublish(contentType)\r\n    ) {\r\n      await strapi.db\r\n        ?.queryBuilder(RELEASE_ACTION_MODEL_UID)\r\n        .delete()\r\n        .where({ contentType: uid })\r\n        .execute();\r\n    }\r\n  }\r\n}\r\n\r\nexport async function deleteActionsOnDeleteContentType({ oldContentTypes, contentTypes }: Input) {\r\n  const deletedContentTypes = difference(keys(oldContentTypes), keys(contentTypes)) ?? [];\r\n\r\n  if (deletedContentTypes.length) {\r\n    await async.map(deletedContentTypes, async (deletedContentTypeUID: unknown) => {\r\n      return strapi.db\r\n        ?.queryBuilder(RELEASE_ACTION_MODEL_UID)\r\n        .delete()\r\n        .where({ contentType: deletedContentTypeUID })\r\n        .execute();\r\n    });\r\n  }\r\n}\r\n\r\nexport async function migrateIsValidAndStatusReleases() {\r\n  const releasesWithoutStatus = (await strapi.db.query(RELEASE_MODEL_UID).findMany({\r\n    where: {\r\n      status: null,\r\n      releasedAt: null,\r\n    },\r\n    populate: {\r\n      actions: {\r\n        populate: {\r\n          entry: true,\r\n        },\r\n      },\r\n    },\r\n  })) as Release[];\r\n\r\n  async.map(releasesWithoutStatus, async (release: Release) => {\r\n    const actions = release.actions;\r\n\r\n    const notValidatedActions = actions.filter((action) => action.isEntryValid === null);\r\n\r\n    for (const action of notValidatedActions) {\r\n      // We need to check the Action is related to a valid entry because we can't assume this is gonna be always the case\r\n      // example: users could make changes directly to their database, or data could be lost\r\n      if (action.entry) {\r\n        const isEntryValid = getDraftEntryValidStatus(\r\n          {\r\n            contentType: action.contentType,\r\n            documentId: action.entryDocumentId,\r\n            locale: action.locale,\r\n          },\r\n          { strapi }\r\n        );\r\n\r\n        await strapi.db.query(RELEASE_ACTION_MODEL_UID).update({\r\n          where: {\r\n            id: action.id,\r\n          },\r\n          data: {\r\n            isEntryValid,\r\n          },\r\n        });\r\n      }\r\n    }\r\n\r\n    return getService('release', { strapi }).updateReleaseStatus(release.id);\r\n  });\r\n\r\n  const publishedReleases = await strapi.db.query(RELEASE_MODEL_UID).findMany({\r\n    where: {\r\n      status: null,\r\n      releasedAt: {\r\n        $notNull: true,\r\n      },\r\n    },\r\n  });\r\n\r\n  async.map(publishedReleases, async (release: Release) => {\r\n    return strapi.db.query(RELEASE_MODEL_UID).update({\r\n      where: {\r\n        id: release.id,\r\n      },\r\n      data: {\r\n        status: 'done',\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\nexport async function revalidateChangedContentTypes({ oldContentTypes, contentTypes }: Input) {\r\n  if (oldContentTypes !== undefined && contentTypes !== undefined) {\r\n    const contentTypesWithDraftAndPublish = Object.keys(oldContentTypes).filter(\r\n      (uid) => oldContentTypes[uid]?.options?.draftAndPublish\r\n    );\r\n    const releasesAffected = new Set();\r\n\r\n    async\r\n      .map(contentTypesWithDraftAndPublish, async (contentTypeUID: UID.ContentType) => {\r\n        const oldContentType = oldContentTypes[contentTypeUID];\r\n        const contentType = contentTypes[contentTypeUID];\r\n\r\n        // If attributes have changed, we need to revalidate actions because maybe validations rules are different\r\n        if (!isEqual(oldContentType?.attributes, contentType?.attributes)) {\r\n          const actions = await strapi.db.query(RELEASE_ACTION_MODEL_UID).findMany({\r\n            where: {\r\n              contentType: contentTypeUID,\r\n            },\r\n            populate: {\r\n              entry: true,\r\n              release: true,\r\n            },\r\n          });\r\n\r\n          await async.map(actions, async (action: ReleaseAction) => {\r\n            if (action.entry && action.release && action.type === 'publish') {\r\n              const isEntryValid = await getDraftEntryValidStatus(\r\n                {\r\n                  contentType: contentTypeUID,\r\n                  documentId: action.entryDocumentId,\r\n                  locale: action.locale,\r\n                },\r\n                { strapi }\r\n              );\r\n\r\n              releasesAffected.add(action.release.id);\r\n\r\n              await strapi.db.query(RELEASE_ACTION_MODEL_UID).update({\r\n                where: {\r\n                  id: action.id,\r\n                },\r\n                data: {\r\n                  isEntryValid,\r\n                },\r\n              });\r\n            }\r\n          });\r\n        }\r\n      })\r\n      .then(() => {\r\n        // We need to update the status of the releases affected\r\n        async.map(releasesAffected, async (releaseId: Release['id']) => {\r\n          return getService('release', { strapi }).updateReleaseStatus(releaseId);\r\n        });\r\n      });\r\n  }\r\n}\r\n\r\nexport async function disableContentTypeLocalized({ oldContentTypes, contentTypes }: Input) {\r\n  if (!oldContentTypes) {\r\n    return;\r\n  }\r\n\r\n  const i18nPlugin = strapi.plugin('i18n');\r\n  if (!i18nPlugin) {\r\n    return;\r\n  }\r\n\r\n  for (const uid in contentTypes) {\r\n    if (!oldContentTypes[uid]) {\r\n      continue;\r\n    }\r\n\r\n    const oldContentType = oldContentTypes[uid];\r\n    const contentType = contentTypes[uid];\r\n\r\n    const { isLocalizedContentType } = i18nPlugin.service('content-types');\r\n\r\n    // if i18N is disabled remove non default locales before sync\r\n    if (isLocalizedContentType(oldContentType) && !isLocalizedContentType(contentType)) {\r\n      await strapi.db\r\n        .queryBuilder(RELEASE_ACTION_MODEL_UID)\r\n        .update({\r\n          locale: null,\r\n        })\r\n        .where({ contentType: uid })\r\n        .execute();\r\n    }\r\n  }\r\n}\r\n\r\nexport async function enableContentTypeLocalized({ oldContentTypes, contentTypes }: Input) {\r\n  if (!oldContentTypes) {\r\n    return;\r\n  }\r\n\r\n  const i18nPlugin = strapi.plugin('i18n');\r\n  if (!i18nPlugin) {\r\n    return;\r\n  }\r\n\r\n  for (const uid in contentTypes) {\r\n    if (!oldContentTypes[uid]) {\r\n      continue;\r\n    }\r\n\r\n    const oldContentType = oldContentTypes[uid];\r\n    const contentType = contentTypes[uid];\r\n\r\n    const { isLocalizedContentType } = i18nPlugin.service('content-types');\r\n    const { getDefaultLocale } = i18nPlugin.service('locales');\r\n\r\n    // if i18N is enabled remove non default locales before sync\r\n    if (!isLocalizedContentType(oldContentType) && isLocalizedContentType(contentType)) {\r\n      const defaultLocale = await getDefaultLocale();\r\n\r\n      await strapi.db\r\n        .queryBuilder(RELEASE_ACTION_MODEL_UID)\r\n        .update({\r\n          locale: defaultLocale,\r\n        })\r\n        .where({ contentType: uid })\r\n        .execute();\r\n    }\r\n  }\r\n}\r\n","import { async } from '@strapi/utils';\r\n\r\nimport type { Migration, Database } from '@strapi/database';\r\n\r\ntype Knex = Parameters<Migration['up']>[0];\r\n\r\n/**\r\n * On v4, release actions are linked with entries using the built in Polymorphic relations.\r\n *\r\n * On v5, we are going to save entryDocumentId on the release action and make the link manually.\r\n * This because entryId is not a reliable way to link documents, as it can change.\r\n */\r\nexport const addEntryDocumentToReleaseActions: Migration = {\r\n  name: 'content-releases::5.0.0-add-entry-document-id-to-release-actions',\r\n  async up(trx: Knex, db: Database) {\r\n    // Check if the table exists\r\n    const hasTable = await trx.schema.hasTable('strapi_release_actions');\r\n\r\n    if (!hasTable) {\r\n      return;\r\n    }\r\n\r\n    const hasPolymorphicColumn = await trx.schema.hasColumn('strapi_release_actions', 'target_id');\r\n\r\n    // If user has PolymorphicColumn means that is coming from v4\r\n    if (hasPolymorphicColumn) {\r\n      // First time coming from v4 user doesn't have entryDocumentId\r\n      // but we double check to avoid errors\r\n      const hasEntryDocumentIdColumn = await trx.schema.hasColumn(\r\n        'strapi_release_actions',\r\n        'entry_document_id'\r\n      );\r\n\r\n      if (!hasEntryDocumentIdColumn) {\r\n        await trx.schema.alterTable('strapi_release_actions', (table) => {\r\n          table.string('entry_document_id');\r\n        });\r\n      }\r\n\r\n      const releaseActions = await trx.select('*').from('strapi_release_actions');\r\n\r\n      async.map(releaseActions, async (action: any) => {\r\n        const { target_type, target_id } = action;\r\n\r\n        const entry = await db.query(target_type).findOne({ where: { id: target_id } });\r\n\r\n        if (entry) {\r\n          await trx('strapi_release_actions')\r\n            .update({ entry_document_id: entry.documentId })\r\n            .where('id', action.id);\r\n        }\r\n      });\r\n    }\r\n  },\r\n  async down() {\r\n    throw new Error('not implemented');\r\n  },\r\n};\r\n","/* eslint-disable @typescript-eslint/no-var-requires */\r\nimport type { Core } from '@strapi/types';\r\n\r\nimport { ACTIONS, RELEASE_MODEL_UID, RELEASE_ACTION_MODEL_UID } from './constants';\r\nimport {\r\n  deleteActionsOnDeleteContentType,\r\n  deleteActionsOnDisableDraftAndPublish,\r\n  migrateIsValidAndStatusReleases,\r\n  revalidateChangedContentTypes,\r\n  disableContentTypeLocalized,\r\n  enableContentTypeLocalized,\r\n} from './migrations';\r\nimport { addEntryDocumentToReleaseActions } from './migrations/database/5.0.0-document-id-in-actions';\r\n\r\nexport const register = async ({ strapi }: { strapi: Core.Strapi }) => {\r\n  if (strapi.ee.features.isEnabled('cms-content-releases')) {\r\n    await strapi.service('admin::permission').actionProvider.registerMany(ACTIONS);\r\n\r\n    strapi.db.migrations.providers.internal.register(addEntryDocumentToReleaseActions);\r\n\r\n    strapi\r\n      .hook('strapi::content-types.beforeSync')\r\n      .register(disableContentTypeLocalized)\r\n      .register(deleteActionsOnDisableDraftAndPublish);\r\n\r\n    strapi\r\n      .hook('strapi::content-types.afterSync')\r\n      .register(deleteActionsOnDeleteContentType)\r\n      .register(enableContentTypeLocalized)\r\n      .register(revalidateChangedContentTypes)\r\n      .register(migrateIsValidAndStatusReleases);\r\n  }\r\n\r\n  if (strapi.plugin('graphql')) {\r\n    const graphqlExtensionService = strapi.plugin('graphql').service('extension');\r\n    // Exclude the release and release action models from the GraphQL schema\r\n    graphqlExtensionService.shadowCRUD(RELEASE_MODEL_UID).disable();\r\n    graphqlExtensionService.shadowCRUD(RELEASE_ACTION_MODEL_UID).disable();\r\n  }\r\n};\r\n","import { Modules, UID } from '@strapi/types';\r\nimport { contentTypes } from '@strapi/utils';\r\nimport { RELEASE_MODEL_UID, RELEASE_ACTION_MODEL_UID } from '../constants';\r\nimport { getService, isEntryValid } from '../utils';\r\n\r\ntype Middleware = Modules.Documents.Middleware.Middleware;\r\n\r\ninterface ReleaseActionsParams {\r\n  contentType: UID.ContentType;\r\n  entryDocumentId?: Modules.Documents.ID;\r\n  locale?: string;\r\n}\r\n\r\nconst updateActionsStatusAndUpdateReleaseStatus = async (\r\n  contentType: UID.ContentType,\r\n  entry: Modules.Documents.AnyDocument\r\n) => {\r\n  const releases = await strapi.db.query(RELEASE_MODEL_UID).findMany({\r\n    where: {\r\n      releasedAt: null,\r\n      actions: {\r\n        contentType,\r\n        entryDocumentId: entry.documentId,\r\n        locale: entry.locale,\r\n      },\r\n    },\r\n  });\r\n\r\n  const entryStatus = await isEntryValid(contentType, entry, { strapi });\r\n\r\n  await strapi.db.query(RELEASE_ACTION_MODEL_UID).updateMany({\r\n    where: {\r\n      contentType,\r\n      entryDocumentId: entry.documentId,\r\n      locale: entry.locale,\r\n    },\r\n    data: {\r\n      isEntryValid: entryStatus,\r\n    },\r\n  });\r\n\r\n  for (const release of releases) {\r\n    getService('release', { strapi }).updateReleaseStatus(release.id);\r\n  }\r\n};\r\n\r\nconst deleteActionsAndUpdateReleaseStatus = async (params: ReleaseActionsParams) => {\r\n  const releases = await strapi.db.query(RELEASE_MODEL_UID).findMany({\r\n    where: {\r\n      actions: params,\r\n    },\r\n  });\r\n\r\n  await strapi.db.query(RELEASE_ACTION_MODEL_UID).deleteMany({\r\n    where: params,\r\n  });\r\n\r\n  for (const release of releases) {\r\n    getService('release', { strapi }).updateReleaseStatus(release.id);\r\n  }\r\n};\r\n\r\nconst deleteActionsOnDelete: Middleware = async (ctx, next) => {\r\n  if (ctx.action !== 'delete') {\r\n    return next();\r\n  }\r\n\r\n  if (!contentTypes.hasDraftAndPublish(ctx.contentType)) {\r\n    return next();\r\n  }\r\n\r\n  const contentType = ctx.contentType.uid;\r\n  const { documentId, locale } = ctx.params;\r\n\r\n  const result = await next();\r\n\r\n  if (!result) {\r\n    return result;\r\n  }\r\n\r\n  try {\r\n    deleteActionsAndUpdateReleaseStatus({\r\n      contentType,\r\n      entryDocumentId: documentId,\r\n      ...(locale !== '*' && { locale }),\r\n    });\r\n  } catch (error) {\r\n    strapi.log.error('Error while deleting release actions after delete', {\r\n      error,\r\n    });\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\nconst updateActionsOnUpdate: Middleware = async (ctx, next) => {\r\n  if (ctx.action !== 'update') {\r\n    return next();\r\n  }\r\n\r\n  if (!contentTypes.hasDraftAndPublish(ctx.contentType)) {\r\n    return next();\r\n  }\r\n\r\n  const contentType = ctx.contentType.uid;\r\n\r\n  const result = (await next()) as Modules.Documents.AnyDocument;\r\n\r\n  if (!result) {\r\n    return result;\r\n  }\r\n\r\n  try {\r\n    updateActionsStatusAndUpdateReleaseStatus(contentType, result);\r\n  } catch (error) {\r\n    strapi.log.error('Error while updating release actions after update', {\r\n      error,\r\n    });\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\nexport { deleteActionsOnDelete, updateActionsOnUpdate };\r\n","/* eslint-disable @typescript-eslint/no-var-requires */\r\nimport type { Core, UID, Modules } from '@strapi/types';\r\n\r\nimport { RELEASE_ACTION_MODEL_UID, RELEASE_MODEL_UID, ALLOWED_WEBHOOK_EVENTS } from './constants';\r\nimport { getService } from './utils';\r\nimport { deleteActionsOnDelete, updateActionsOnUpdate } from './middlewares/documents';\r\n\r\ninterface DeleteManyParams {\r\n  contentType: UID.ContentType;\r\n  locale: string | null;\r\n  entryDocumentId?: Modules.Documents.ID;\r\n}\r\n\r\nconst deleteReleasesActionsAndUpdateReleaseStatus = async (params: DeleteManyParams) => {\r\n  const releases = await strapi.db.query(RELEASE_MODEL_UID).findMany({\r\n    where: {\r\n      actions: params,\r\n    },\r\n  });\r\n\r\n  await strapi.db.query(RELEASE_ACTION_MODEL_UID).deleteMany({\r\n    where: params,\r\n  });\r\n\r\n  // We update the status of each release after delete the actions\r\n  for (const release of releases) {\r\n    getService('release', { strapi }).updateReleaseStatus(release.id);\r\n  }\r\n};\r\n\r\nexport const bootstrap = async ({ strapi }: { strapi: Core.Strapi }) => {\r\n  if (strapi.ee.features.isEnabled('cms-content-releases')) {\r\n    const contentTypesWithDraftAndPublish = Object.keys(strapi.contentTypes).filter(\r\n      (uid: any) => strapi.contentTypes[uid]?.options?.draftAndPublish\r\n    );\r\n\r\n    strapi.db.lifecycles.subscribe({\r\n      models: contentTypesWithDraftAndPublish,\r\n\r\n      /**\r\n       * deleteMany is still used outside documents service, for example when deleting a locale\r\n       */\r\n      async afterDeleteMany(event) {\r\n        try {\r\n          const model = strapi.getModel(event.model.uid as UID.Schema);\r\n          // @ts-expect-error TODO: lifecycles types looks like are not 100% finished\r\n          if (model.kind === 'collectionType' && model.options?.draftAndPublish) {\r\n            const { where } = event.params;\r\n\r\n            deleteReleasesActionsAndUpdateReleaseStatus({\r\n              contentType: model.uid,\r\n              locale: where?.locale ?? null,\r\n              ...(where?.documentId && { entryDocumentId: where.documentId }),\r\n            });\r\n          }\r\n        } catch (error) {\r\n          // If an error happens we don't want to block the delete entry flow, but we log the error\r\n          strapi.log.error('Error while deleting release actions after entry deleteMany', {\r\n            error,\r\n          });\r\n        }\r\n      },\r\n    });\r\n\r\n    // We register middleware to handle ReleaseActions when changes on documents are made\r\n    strapi.documents.use(deleteActionsOnDelete);\r\n    strapi.documents.use(updateActionsOnUpdate);\r\n\r\n    getService('scheduling', { strapi })\r\n      .syncFromDatabase()\r\n      .catch((err: Error) => {\r\n        strapi.log.error(\r\n          'Error while syncing scheduled jobs from the database in the content-releases plugin. This could lead to errors in the releases scheduling.'\r\n        );\r\n\r\n        throw err;\r\n      });\r\n\r\n    Object.entries(ALLOWED_WEBHOOK_EVENTS).forEach(([key, value]) => {\r\n      strapi.get('webhookStore').addAllowedEvent(key, value);\r\n    });\r\n  }\r\n};\r\n","import { Job } from 'node-schedule';\r\nimport { Core } from '@strapi/types';\r\n\r\nimport { Release } from '../../shared/contracts/releases';\r\nimport { getService } from './utils';\r\n\r\nexport const destroy = async ({ strapi }: { strapi: Core.Strapi }) => {\r\n  const scheduledJobs: Map<Release['id'], Job> = getService('scheduling', {\r\n    strapi,\r\n  }).getAll();\r\n\r\n  for (const [, job] of scheduledJobs) {\r\n    job.cancel();\r\n  }\r\n};\r\n","import { RELEASE_ACTION_MODEL_UID } from '../../constants';\r\n\r\nexport default {\r\n  collectionName: 'strapi_releases',\r\n  info: {\r\n    singularName: 'release',\r\n    pluralName: 'releases',\r\n    displayName: 'Release',\r\n  },\r\n  options: {\r\n    draftAndPublish: false,\r\n  },\r\n  pluginOptions: {\r\n    'content-manager': {\r\n      visible: false,\r\n    },\r\n    'content-type-builder': {\r\n      visible: false,\r\n    },\r\n  },\r\n  attributes: {\r\n    name: {\r\n      type: 'string',\r\n      required: true,\r\n    },\r\n    releasedAt: {\r\n      type: 'datetime',\r\n    },\r\n    scheduledAt: {\r\n      type: 'datetime',\r\n    },\r\n    timezone: {\r\n      type: 'string',\r\n    },\r\n    status: {\r\n      type: 'enumeration',\r\n      enum: ['ready', 'blocked', 'failed', 'done', 'empty'],\r\n      required: true,\r\n    },\r\n    actions: {\r\n      type: 'relation',\r\n      relation: 'oneToMany',\r\n      target: RELEASE_ACTION_MODEL_UID,\r\n      mappedBy: 'release',\r\n    },\r\n  },\r\n};\r\n","import schema from './schema';\r\n\r\nexport const release = {\r\n  schema,\r\n};\r\n","import { RELEASE_MODEL_UID } from '../../constants';\r\n\r\nexport default {\r\n  collectionName: 'strapi_release_actions',\r\n  info: {\r\n    singularName: 'release-action',\r\n    pluralName: 'release-actions',\r\n    displayName: 'Release Action',\r\n  },\r\n  options: {\r\n    draftAndPublish: false,\r\n  },\r\n  pluginOptions: {\r\n    'content-manager': {\r\n      visible: false,\r\n    },\r\n    'content-type-builder': {\r\n      visible: false,\r\n    },\r\n  },\r\n  attributes: {\r\n    type: {\r\n      type: 'enumeration',\r\n      enum: ['publish', 'unpublish'],\r\n      required: true,\r\n    },\r\n    contentType: {\r\n      type: 'string',\r\n      required: true,\r\n    },\r\n    entryDocumentId: {\r\n      type: 'string',\r\n    },\r\n    locale: {\r\n      type: 'string',\r\n    },\r\n    release: {\r\n      type: 'relation',\r\n      relation: 'manyToOne',\r\n      target: RELEASE_MODEL_UID,\r\n      inversedBy: 'actions',\r\n    },\r\n    isEntryValid: {\r\n      type: 'boolean',\r\n    },\r\n  },\r\n};\r\n","import schema from './schema';\r\n\r\nexport const releaseAction = {\r\n  schema,\r\n};\r\n","import { release } from './release';\r\nimport { releaseAction } from './release-action';\r\n\r\nexport const contentTypes = {\r\n  release,\r\n  'release-action': releaseAction,\r\n};\r\n","import { setCreatorFields, errors } from '@strapi/utils';\r\n\r\nimport type { Core, Struct, UID, Data } from '@strapi/types';\r\n\r\nimport { ALLOWED_WEBHOOK_EVENTS, RELEASE_ACTION_MODEL_UID, RELEASE_MODEL_UID } from '../constants';\r\nimport type {\r\n  GetReleases,\r\n  CreateRelease,\r\n  UpdateRelease,\r\n  PublishRelease,\r\n  GetRelease,\r\n  Release,\r\n  DeleteRelease,\r\n} from '../../../shared/contracts/releases';\r\nimport type { ReleaseAction } from '../../../shared/contracts/release-actions';\r\nimport type { UserInfo } from '../../../shared/types';\r\nimport { getService } from '../utils';\r\n\r\nconst createReleaseService = ({ strapi }: { strapi: Core.Strapi }) => {\r\n  const dispatchWebhook = (\r\n    event: string,\r\n    { isPublished, release, error }: { isPublished: boolean; release?: any; error?: unknown }\r\n  ) => {\r\n    strapi.eventHub.emit(event, {\r\n      isPublished,\r\n      error,\r\n      release,\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Given a release id, it returns the actions formatted ready to be used to publish them.\r\n   * We split them by contentType and type (publish/unpublish) and extract only the documentIds and locales.\r\n   */\r\n  const getFormattedActions = async (releaseId: Release['id']) => {\r\n    const actions = (await strapi.db.query(RELEASE_ACTION_MODEL_UID).findMany({\r\n      where: {\r\n        release: {\r\n          id: releaseId,\r\n        },\r\n      },\r\n    })) as ReleaseAction[];\r\n\r\n    if (actions.length === 0) {\r\n      throw new errors.ValidationError('No entries to publish');\r\n    }\r\n\r\n    /**\r\n     * We separate publish and unpublish actions, grouping them by contentType and extracting only their documentIds and locales.\r\n     */\r\n    const formattedActions: {\r\n      [key: UID.ContentType]: {\r\n        publish: { documentId: ReleaseAction['entryDocumentId']; locale?: string }[];\r\n        unpublish: { documentId: ReleaseAction['entryDocumentId']; locale?: string }[];\r\n      };\r\n    } = {};\r\n\r\n    for (const action of actions) {\r\n      const contentTypeUid: UID.ContentType = action.contentType;\r\n\r\n      if (!formattedActions[contentTypeUid]) {\r\n        formattedActions[contentTypeUid] = {\r\n          publish: [],\r\n          unpublish: [],\r\n        };\r\n      }\r\n\r\n      formattedActions[contentTypeUid][action.type].push({\r\n        documentId: action.entryDocumentId,\r\n        locale: action.locale,\r\n      });\r\n    }\r\n\r\n    return formattedActions;\r\n  };\r\n\r\n  return {\r\n    async create(releaseData: CreateRelease.Request['body'], { user }: { user: UserInfo }) {\r\n      const releaseWithCreatorFields = await setCreatorFields({ user })(releaseData);\r\n\r\n      const {\r\n        validatePendingReleasesLimit,\r\n        validateUniqueNameForPendingRelease,\r\n        validateScheduledAtIsLaterThanNow,\r\n      } = getService('release-validation', { strapi });\r\n\r\n      await Promise.all([\r\n        validatePendingReleasesLimit(),\r\n        validateUniqueNameForPendingRelease(releaseWithCreatorFields.name),\r\n        validateScheduledAtIsLaterThanNow(releaseWithCreatorFields.scheduledAt),\r\n      ]);\r\n\r\n      const release = await strapi.db.query(RELEASE_MODEL_UID).create({\r\n        data: {\r\n          ...releaseWithCreatorFields,\r\n          status: 'empty',\r\n        },\r\n      });\r\n\r\n      if (releaseWithCreatorFields.scheduledAt) {\r\n        const schedulingService = getService('scheduling', { strapi });\r\n\r\n        await schedulingService.set(release.id, release.scheduledAt);\r\n      }\r\n\r\n      strapi.telemetry.send('didCreateContentRelease');\r\n\r\n      return release;\r\n    },\r\n\r\n    async findOne(id: GetRelease.Request['params']['id'], query = {}) {\r\n      const dbQuery = strapi.get('query-params').transform(RELEASE_MODEL_UID, query);\r\n      const release = await strapi.db.query(RELEASE_MODEL_UID).findOne({\r\n        ...dbQuery,\r\n        where: { id },\r\n      });\r\n\r\n      return release;\r\n    },\r\n\r\n    findPage(query?: GetReleases.Request['query']) {\r\n      const dbQuery = strapi.get('query-params').transform(RELEASE_MODEL_UID, query ?? {});\r\n\r\n      return strapi.db.query(RELEASE_MODEL_UID).findPage({\r\n        ...dbQuery,\r\n        populate: {\r\n          actions: {\r\n            count: true,\r\n          },\r\n        },\r\n      });\r\n    },\r\n\r\n    findMany(query?: any) {\r\n      const dbQuery = strapi.get('query-params').transform(RELEASE_MODEL_UID, query ?? {});\r\n\r\n      return strapi.db.query(RELEASE_MODEL_UID).findMany({\r\n        ...dbQuery,\r\n      });\r\n    },\r\n\r\n    async update(\r\n      id: Data.ID,\r\n      releaseData: UpdateRelease.Request['body'],\r\n      { user }: { user: UserInfo }\r\n    ) {\r\n      const releaseWithCreatorFields = await setCreatorFields({ user, isEdition: true })(\r\n        releaseData\r\n      );\r\n\r\n      const { validateUniqueNameForPendingRelease, validateScheduledAtIsLaterThanNow } = getService(\r\n        'release-validation',\r\n        { strapi }\r\n      );\r\n\r\n      await Promise.all([\r\n        validateUniqueNameForPendingRelease(releaseWithCreatorFields.name, id),\r\n        validateScheduledAtIsLaterThanNow(releaseWithCreatorFields.scheduledAt),\r\n      ]);\r\n\r\n      const release = await strapi.db.query(RELEASE_MODEL_UID).findOne({ where: { id } });\r\n\r\n      if (!release) {\r\n        throw new errors.NotFoundError(`No release found for id ${id}`);\r\n      }\r\n\r\n      if (release.releasedAt) {\r\n        throw new errors.ValidationError('Release already published');\r\n      }\r\n\r\n      const updatedRelease = await strapi.db.query(RELEASE_MODEL_UID).update({\r\n        where: { id },\r\n        data: releaseWithCreatorFields,\r\n      });\r\n\r\n      const schedulingService = getService('scheduling', { strapi });\r\n\r\n      if (releaseData.scheduledAt) {\r\n        // set function always cancel the previous job if it exists, so we can call it directly\r\n        await schedulingService.set(id, releaseData.scheduledAt);\r\n      } else if (release.scheduledAt) {\r\n        // When user don't send a scheduledAt and we have one on the release, means that user want to unschedule it\r\n        schedulingService.cancel(id);\r\n      }\r\n\r\n      this.updateReleaseStatus(id);\r\n\r\n      strapi.telemetry.send('didUpdateContentRelease');\r\n\r\n      return updatedRelease;\r\n    },\r\n\r\n    async getAllComponents() {\r\n      const contentManagerComponentsService = strapi\r\n        .plugin('content-manager')\r\n        .service('components');\r\n\r\n      const components = await contentManagerComponentsService.findAllComponents();\r\n\r\n      const componentsMap = components.reduce(\r\n        (\r\n          acc: { [key: Struct.ComponentSchema['uid']]: Struct.ComponentSchema },\r\n          component: Struct.ComponentSchema\r\n        ) => {\r\n          acc[component.uid] = component;\r\n\r\n          return acc;\r\n        },\r\n        {}\r\n      );\r\n\r\n      return componentsMap;\r\n    },\r\n\r\n    async delete(releaseId: DeleteRelease.Request['params']['id']) {\r\n      const release: Release = await strapi.db.query(RELEASE_MODEL_UID).findOne({\r\n        where: { id: releaseId },\r\n        populate: {\r\n          actions: {\r\n            select: ['id'],\r\n          },\r\n        },\r\n      });\r\n\r\n      if (!release) {\r\n        throw new errors.NotFoundError(`No release found for id ${releaseId}`);\r\n      }\r\n\r\n      if (release.releasedAt) {\r\n        throw new errors.ValidationError('Release already published');\r\n      }\r\n\r\n      // Only delete the release and its actions is you in fact can delete all the actions and the release\r\n      // Otherwise, if the transaction fails it throws an error\r\n      await strapi.db.transaction(async () => {\r\n        await strapi.db.query(RELEASE_ACTION_MODEL_UID).deleteMany({\r\n          where: {\r\n            id: {\r\n              $in: release.actions.map((action) => action.id),\r\n            },\r\n          },\r\n        });\r\n\r\n        await strapi.db.query(RELEASE_MODEL_UID).delete({\r\n          where: {\r\n            id: releaseId,\r\n          },\r\n        });\r\n      });\r\n\r\n      if (release.scheduledAt) {\r\n        const schedulingService = getService('scheduling', { strapi });\r\n        await schedulingService.cancel(release.id);\r\n      }\r\n\r\n      strapi.telemetry.send('didDeleteContentRelease');\r\n\r\n      return release;\r\n    },\r\n\r\n    async publish(releaseId: PublishRelease.Request['params']['id']) {\r\n      const {\r\n        release,\r\n        error,\r\n      }: { release: Pick<Release, 'id' | 'releasedAt' | 'status'> | null; error: unknown | null } =\r\n        await strapi.db.transaction(async ({ trx }) => {\r\n          /**\r\n           * We lock the release in this transaction, so any other process trying to publish it will wait until this transaction is finished\r\n           * In this transaction we don't care about rollback, becasue we want to persist the lock until the end and if it fails we want to change the release status to failed\r\n           */\r\n          const lockedRelease = (await strapi.db\r\n            ?.queryBuilder(RELEASE_MODEL_UID)\r\n            .where({ id: releaseId })\r\n            .select(['id', 'name', 'releasedAt', 'status'])\r\n            .first()\r\n            .transacting(trx)\r\n            .forUpdate()\r\n            .execute()) as Pick<Release, 'id' | 'name' | 'releasedAt' | 'status'> | undefined;\r\n\r\n          if (!lockedRelease) {\r\n            throw new errors.NotFoundError(`No release found for id ${releaseId}`);\r\n          }\r\n\r\n          if (lockedRelease.releasedAt) {\r\n            throw new errors.ValidationError('Release already published');\r\n          }\r\n\r\n          if (lockedRelease.status === 'failed') {\r\n            throw new errors.ValidationError('Release failed to publish');\r\n          }\r\n\r\n          try {\r\n            strapi.log.info(`[Content Releases] Starting to publish release ${lockedRelease.name}`);\r\n\r\n            const formattedActions = await getFormattedActions(releaseId);\r\n\r\n            await strapi.db.transaction(async () =>\r\n              Promise.all(\r\n                Object.keys(formattedActions).map(async (contentTypeUid) => {\r\n                  const contentType = contentTypeUid as UID.ContentType;\r\n                  const { publish, unpublish } = formattedActions[contentType];\r\n\r\n                  return Promise.all([\r\n                    ...publish.map((params) => strapi.documents(contentType).publish(params)),\r\n                    ...unpublish.map((params) => strapi.documents(contentType).unpublish(params)),\r\n                  ]);\r\n                })\r\n              )\r\n            );\r\n\r\n            const release = await strapi.db.query(RELEASE_MODEL_UID).update({\r\n              where: {\r\n                id: releaseId,\r\n              },\r\n              data: {\r\n                status: 'done',\r\n                releasedAt: new Date(),\r\n              },\r\n            });\r\n\r\n            dispatchWebhook(ALLOWED_WEBHOOK_EVENTS.RELEASES_PUBLISH, {\r\n              isPublished: true,\r\n              release,\r\n            });\r\n\r\n            strapi.telemetry.send('didPublishContentRelease');\r\n\r\n            return { release, error: null };\r\n          } catch (error) {\r\n            dispatchWebhook(ALLOWED_WEBHOOK_EVENTS.RELEASES_PUBLISH, {\r\n              isPublished: false,\r\n              error,\r\n            });\r\n\r\n            // We need to run the update in the same transaction because the release is locked\r\n            await strapi.db\r\n              ?.queryBuilder(RELEASE_MODEL_UID)\r\n              .where({ id: releaseId })\r\n              .update({\r\n                status: 'failed',\r\n              })\r\n              .transacting(trx)\r\n              .execute();\r\n\r\n            // At this point, we don't want to throw the error because if that happen we rollback the change in the release status\r\n            // We want to throw the error after the transaction is finished, so we return the error\r\n            return {\r\n              release: null,\r\n              error,\r\n            };\r\n          }\r\n        });\r\n\r\n      // Now the first transaction is commited, we can safely throw the error if it exists\r\n      if (error instanceof Error) {\r\n        throw error;\r\n      }\r\n\r\n      return release;\r\n    },\r\n\r\n    async updateReleaseStatus(releaseId: Release['id']) {\r\n      const releaseActionService = getService('release-action', { strapi });\r\n\r\n      const [totalActions, invalidActions] = await Promise.all([\r\n        releaseActionService.countActions({\r\n          filters: {\r\n            release: releaseId,\r\n          },\r\n        }),\r\n        releaseActionService.countActions({\r\n          filters: {\r\n            release: releaseId,\r\n            isEntryValid: false,\r\n          },\r\n        }),\r\n      ]);\r\n\r\n      if (totalActions > 0) {\r\n        if (invalidActions > 0) {\r\n          return strapi.db.query(RELEASE_MODEL_UID).update({\r\n            where: {\r\n              id: releaseId,\r\n            },\r\n            data: {\r\n              status: 'blocked',\r\n            },\r\n          });\r\n        }\r\n\r\n        return strapi.db.query(RELEASE_MODEL_UID).update({\r\n          where: {\r\n            id: releaseId,\r\n          },\r\n          data: {\r\n            status: 'ready',\r\n          },\r\n        });\r\n      }\r\n\r\n      return strapi.db.query(RELEASE_MODEL_UID).update({\r\n        where: {\r\n          id: releaseId,\r\n        },\r\n        data: {\r\n          status: 'empty',\r\n        },\r\n      });\r\n    },\r\n  };\r\n};\r\n\r\nexport type ReleaseService = ReturnType<typeof createReleaseService>;\r\n\r\nexport default createReleaseService;\r\n","import { errors, async } from '@strapi/utils';\r\n\r\nimport type { Core, Internal, Modules, UID, Data } from '@strapi/types';\r\n\r\nimport _ from 'lodash/fp';\r\n\r\nimport { RELEASE_ACTION_MODEL_UID, RELEASE_MODEL_UID } from '../constants';\r\n\r\nimport type {\r\n  CreateReleaseAction,\r\n  GetReleaseActions,\r\n  ReleaseAction,\r\n  ReleaseActionGroupBy,\r\n  UpdateReleaseAction,\r\n  DeleteReleaseAction,\r\n} from '../../../shared/contracts/release-actions';\r\nimport type { Entity } from '../../../shared/types';\r\nimport { getService, getDraftEntryValidStatus, getEntry, getEntryStatus } from '../utils';\r\n\r\nconst getGroupName = (queryValue: string) => {\r\n  switch (queryValue) {\r\n    case 'contentType':\r\n      return 'contentType.displayName';\r\n    case 'type':\r\n      return 'type';\r\n    case 'locale':\r\n      return _.getOr('No locale', 'locale.name');\r\n    default:\r\n      return 'contentType.displayName';\r\n  }\r\n};\r\n\r\nexport interface Locale extends Entity {\r\n  name: string;\r\n  code: string;\r\n}\r\n\r\ntype LocaleDictionary = {\r\n  [key: Locale['code']]: Pick<Locale, 'name' | 'code'>;\r\n};\r\n\r\nconst createReleaseActionService = ({ strapi }: { strapi: Core.Strapi }) => {\r\n  const getLocalesDataForActions = async () => {\r\n    if (!strapi.plugin('i18n')) {\r\n      return {};\r\n    }\r\n\r\n    const allLocales: Locale[] = (await strapi.plugin('i18n').service('locales').find()) || [];\r\n    return allLocales.reduce<LocaleDictionary>((acc, locale) => {\r\n      acc[locale.code] = { name: locale.name, code: locale.code };\r\n\r\n      return acc;\r\n    }, {});\r\n  };\r\n\r\n  const getContentTypesDataForActions = async (\r\n    contentTypesUids: ReleaseAction['contentType'][]\r\n  ) => {\r\n    const contentManagerContentTypeService = strapi\r\n      .plugin('content-manager')\r\n      .service('content-types');\r\n\r\n    const contentTypesData: Record<\r\n      Internal.UID.ContentType,\r\n      { mainField: string; displayName: string }\r\n    > = {};\r\n    for (const contentTypeUid of contentTypesUids) {\r\n      const contentTypeConfig = await contentManagerContentTypeService.findConfiguration({\r\n        uid: contentTypeUid,\r\n      });\r\n\r\n      contentTypesData[contentTypeUid] = {\r\n        mainField: contentTypeConfig.settings.mainField,\r\n        displayName: strapi.getModel(contentTypeUid).info.displayName,\r\n      };\r\n    }\r\n\r\n    return contentTypesData;\r\n  };\r\n\r\n  return {\r\n    async create(\r\n      releaseId: CreateReleaseAction.Request['params']['releaseId'],\r\n      action: CreateReleaseAction.Request['body'],\r\n      { disableUpdateReleaseStatus = false }: { disableUpdateReleaseStatus?: boolean } = {}\r\n    ) {\r\n      const { validateEntryData, validateUniqueEntry } = getService('release-validation', {\r\n        strapi,\r\n      });\r\n\r\n      await Promise.all([\r\n        validateEntryData(action.contentType, action.entryDocumentId),\r\n        validateUniqueEntry(releaseId, action),\r\n      ]);\r\n\r\n      // If we are adding a singleType, we need to append the documentId of that singleType\r\n      const model = strapi.contentType(action.contentType);\r\n      if (model.kind === 'singleType') {\r\n        const document = await strapi.db.query(model.uid).findOne({ select: ['documentId'] });\r\n\r\n        if (!document) {\r\n          throw new errors.NotFoundError(`No entry found for contentType ${action.contentType}`);\r\n        }\r\n\r\n        action.entryDocumentId = document.documentId;\r\n      }\r\n\r\n      const release = await strapi.db\r\n        .query(RELEASE_MODEL_UID)\r\n        .findOne({ where: { id: releaseId } });\r\n\r\n      if (!release) {\r\n        throw new errors.NotFoundError(`No release found for id ${releaseId}`);\r\n      }\r\n\r\n      if (release.releasedAt) {\r\n        throw new errors.ValidationError('Release already published');\r\n      }\r\n\r\n      // If the action is a publish, check if the entry is valid\r\n      // If the action is an unpublish, skip the validation\r\n      const actionStatus =\r\n        action.type === 'publish'\r\n          ? await getDraftEntryValidStatus(\r\n              {\r\n                contentType: action.contentType,\r\n                documentId: action.entryDocumentId,\r\n                locale: action.locale,\r\n              },\r\n              {\r\n                strapi,\r\n              }\r\n            )\r\n          : true;\r\n\r\n      const releaseAction = await strapi.db.query(RELEASE_ACTION_MODEL_UID).create({\r\n        data: {\r\n          ...action,\r\n          release: release.id,\r\n          isEntryValid: actionStatus,\r\n        },\r\n        populate: { release: { select: ['id'] } },\r\n      });\r\n\r\n      if (!disableUpdateReleaseStatus) {\r\n        getService('release', { strapi }).updateReleaseStatus(release.id);\r\n      }\r\n\r\n      return releaseAction;\r\n    },\r\n\r\n    async findPage(\r\n      releaseId: GetReleaseActions.Request['params']['releaseId'],\r\n      query?: GetReleaseActions.Request['query']\r\n    ) {\r\n      const release = await strapi.db.query(RELEASE_MODEL_UID).findOne({\r\n        where: { id: releaseId },\r\n        select: ['id'],\r\n      });\r\n\r\n      if (!release) {\r\n        throw new errors.NotFoundError(`No release found for id ${releaseId}`);\r\n      }\r\n\r\n      const dbQuery = strapi.get('query-params').transform(RELEASE_ACTION_MODEL_UID, query ?? {});\r\n      const { results: actions, pagination } = await strapi.db\r\n        .query(RELEASE_ACTION_MODEL_UID)\r\n        .findPage({\r\n          ...dbQuery,\r\n          where: {\r\n            release: releaseId,\r\n          },\r\n        });\r\n\r\n      // For each contentType on the release, we create a custom populate object for nested relations\r\n      const populateBuilderService = strapi.plugin('content-manager').service('populate-builder');\r\n\r\n      const actionsWithEntry = await async.map(actions, async (action: ReleaseAction) => {\r\n        // @ts-expect-error - Core.Service type is not a function\r\n        const populate = await populateBuilderService(action.contentType)\r\n          .populateDeep(Infinity)\r\n          .build();\r\n\r\n        const entry = await getEntry(\r\n          {\r\n            contentType: action.contentType,\r\n            documentId: action.entryDocumentId,\r\n            locale: action.locale,\r\n            populate,\r\n            status: action.type === 'publish' ? 'draft' : 'published',\r\n          },\r\n          { strapi }\r\n        );\r\n\r\n        return {\r\n          ...action,\r\n          entry,\r\n          status: entry ? await getEntryStatus(action.contentType, entry) : null,\r\n        };\r\n      });\r\n\r\n      return {\r\n        results: actionsWithEntry,\r\n        pagination,\r\n      };\r\n    },\r\n\r\n    async groupActions(actions: ReleaseAction[], groupBy: ReleaseActionGroupBy) {\r\n      const contentTypeUids = actions.reduce<ReleaseAction['contentType'][]>((acc, action) => {\r\n        if (!acc.includes(action.contentType)) {\r\n          acc.push(action.contentType);\r\n        }\r\n\r\n        return acc;\r\n      }, []);\r\n      const allReleaseContentTypesDictionary = await getContentTypesDataForActions(contentTypeUids);\r\n      const allLocalesDictionary = await getLocalesDataForActions();\r\n\r\n      const formattedData = actions.map((action: ReleaseAction) => {\r\n        const { mainField, displayName } = allReleaseContentTypesDictionary[action.contentType];\r\n\r\n        return {\r\n          ...action,\r\n          locale: action.locale ? allLocalesDictionary[action.locale] : null,\r\n          contentType: {\r\n            displayName,\r\n            mainFieldValue: action.entry[mainField],\r\n            uid: action.contentType,\r\n          },\r\n        };\r\n      });\r\n\r\n      const groupName = getGroupName(groupBy);\r\n      return _.groupBy(groupName)(formattedData);\r\n    },\r\n\r\n    async getContentTypeModelsFromActions(actions: ReleaseAction[]) {\r\n      const contentTypeUids = actions.reduce<ReleaseAction['contentType'][]>((acc, action) => {\r\n        if (!acc.includes(action.contentType)) {\r\n          acc.push(action.contentType);\r\n        }\r\n\r\n        return acc;\r\n      }, []);\r\n\r\n      const workflowsService = strapi.plugin('review-workflows').service('workflows');\r\n\r\n      const contentTypeModelsMap = await async.reduce(contentTypeUids)(\r\n        async (\r\n          accPromise: Promise<GetReleaseActions.Response['meta']['contentTypes']>,\r\n          contentTypeUid: ReleaseAction['contentType']\r\n        ) => {\r\n          const acc = await accPromise;\r\n          const contentTypeModel = strapi.getModel(contentTypeUid);\r\n\r\n          const workflow = await workflowsService.getAssignedWorkflow(contentTypeUid, {\r\n            populate: 'stageRequiredToPublish',\r\n          });\r\n\r\n          acc[contentTypeUid] = {\r\n            ...contentTypeModel,\r\n            hasReviewWorkflow: !!workflow,\r\n            stageRequiredToPublish: workflow?.stageRequiredToPublish,\r\n          };\r\n\r\n          return acc;\r\n        },\r\n        {}\r\n      );\r\n\r\n      return contentTypeModelsMap;\r\n    },\r\n\r\n    async countActions(\r\n      query: Modules.EntityService.Params.Pick<typeof RELEASE_ACTION_MODEL_UID, 'filters'>\r\n    ) {\r\n      const dbQuery = strapi.get('query-params').transform(RELEASE_ACTION_MODEL_UID, query ?? {});\r\n\r\n      return strapi.db.query(RELEASE_ACTION_MODEL_UID).count(dbQuery);\r\n    },\r\n\r\n    async update(\r\n      actionId: UpdateReleaseAction.Request['params']['actionId'],\r\n      releaseId: UpdateReleaseAction.Request['params']['releaseId'],\r\n      update: UpdateReleaseAction.Request['body']\r\n    ) {\r\n      const action = await strapi.db.query(RELEASE_ACTION_MODEL_UID).findOne({\r\n        where: {\r\n          id: actionId,\r\n          release: {\r\n            id: releaseId,\r\n            releasedAt: {\r\n              $null: true,\r\n            },\r\n          },\r\n        },\r\n      });\r\n\r\n      if (!action) {\r\n        throw new errors.NotFoundError(\r\n          `Action with id ${actionId} not found in release with id ${releaseId} or it is already published`\r\n        );\r\n      }\r\n\r\n      const actionStatus =\r\n        update.type === 'publish'\r\n          ? await getDraftEntryValidStatus(\r\n              {\r\n                contentType: action.contentType,\r\n                documentId: action.entryDocumentId,\r\n                locale: action.locale,\r\n              },\r\n              {\r\n                strapi,\r\n              }\r\n            )\r\n          : true;\r\n\r\n      const updatedAction = await strapi.db.query(RELEASE_ACTION_MODEL_UID).update({\r\n        where: {\r\n          id: actionId,\r\n          release: {\r\n            id: releaseId,\r\n            releasedAt: {\r\n              $null: true,\r\n            },\r\n          },\r\n        },\r\n        data: {\r\n          ...update,\r\n          isEntryValid: actionStatus,\r\n        },\r\n      });\r\n\r\n      getService('release', { strapi }).updateReleaseStatus(releaseId);\r\n\r\n      return updatedAction;\r\n    },\r\n\r\n    async delete(\r\n      actionId: DeleteReleaseAction.Request['params']['actionId'],\r\n      releaseId: DeleteReleaseAction.Request['params']['releaseId']\r\n    ) {\r\n      const deletedAction = await strapi.db.query(RELEASE_ACTION_MODEL_UID).delete({\r\n        where: {\r\n          id: actionId,\r\n          release: {\r\n            id: releaseId,\r\n            releasedAt: {\r\n              $null: true,\r\n            },\r\n          },\r\n        },\r\n      });\r\n\r\n      if (!deletedAction) {\r\n        throw new errors.NotFoundError(\r\n          `Action with id ${actionId} not found in release with id ${releaseId} or it is already published`\r\n        );\r\n      }\r\n\r\n      getService('release', { strapi }).updateReleaseStatus(releaseId);\r\n\r\n      return deletedAction;\r\n    },\r\n\r\n    async validateActionsByContentTypes(contentTypeUids: UID.ContentType[]) {\r\n      const actions = await strapi.db.query(RELEASE_ACTION_MODEL_UID).findMany({\r\n        where: {\r\n          contentType: {\r\n            $in: contentTypeUids,\r\n          },\r\n          // We only want to validate actions that are going to be published\r\n          type: 'publish',\r\n          release: {\r\n            releasedAt: {\r\n              $null: true,\r\n            },\r\n          },\r\n        },\r\n        populate: { release: true },\r\n      });\r\n\r\n      const releasesUpdated: Data.ID[] = [];\r\n\r\n      await async.map(actions, async (action: ReleaseAction) => {\r\n        const isValid = await getDraftEntryValidStatus(\r\n          {\r\n            contentType: action.contentType,\r\n            documentId: action.entryDocumentId,\r\n            locale: action.locale,\r\n          },\r\n          { strapi }\r\n        );\r\n\r\n        await strapi.db.query(RELEASE_ACTION_MODEL_UID).update({\r\n          where: {\r\n            id: action.id,\r\n          },\r\n          data: {\r\n            isEntryValid: isValid,\r\n          },\r\n        });\r\n\r\n        if (!releasesUpdated.includes(action.release.id)) {\r\n          releasesUpdated.push(action.release.id);\r\n        }\r\n\r\n        return {\r\n          id: action.id,\r\n          isEntryValid: isValid,\r\n        };\r\n      });\r\n\r\n      if (releasesUpdated.length > 0) {\r\n        await async.map(releasesUpdated, async (releaseId: number) => {\r\n          await getService('release', { strapi }).updateReleaseStatus(releaseId);\r\n        });\r\n      }\r\n    },\r\n  };\r\n};\r\n\r\nexport type ReleaseActionService = ReturnType<typeof createReleaseActionService>;\r\n\r\nexport default createReleaseActionService;\r\n","import { errors, contentTypes } from '@strapi/utils';\r\nimport { Core, UID } from '@strapi/types';\r\nimport type { Release, CreateRelease, UpdateRelease } from '../../../shared/contracts/releases';\r\nimport type { CreateReleaseAction } from '../../../shared/contracts/release-actions';\r\nimport { RELEASE_MODEL_UID } from '../constants';\r\n\r\nexport class AlreadyOnReleaseError extends errors.ApplicationError<'AlreadyOnReleaseError'> {\r\n  constructor(message: string) {\r\n    super(message);\r\n    this.name = 'AlreadyOnReleaseError';\r\n  }\r\n}\r\n\r\nconst createReleaseValidationService = ({ strapi }: { strapi: Core.Strapi }) => ({\r\n  async validateUniqueEntry(\r\n    releaseId: CreateReleaseAction.Request['params']['releaseId'],\r\n    releaseActionArgs: CreateReleaseAction.Request['body']\r\n  ) {\r\n    /**\r\n     * Asserting the type, otherwise TS complains: 'release.actions' is of type 'unknown', even though the types come through for non-populated fields...\r\n     * Possibly related to the comment on GetValues: https://github.com/strapi/strapi/blob/main/packages/core/types/src/modules/entity-service/result.ts\r\n     */\r\n    const release = (await strapi.db.query(RELEASE_MODEL_UID).findOne({\r\n      where: {\r\n        id: releaseId,\r\n      },\r\n      populate: {\r\n        actions: true,\r\n      },\r\n    })) as Release | null;\r\n\r\n    if (!release) {\r\n      throw new errors.NotFoundError(`No release found for id ${releaseId}`);\r\n    }\r\n\r\n    const isEntryInRelease = release.actions.some(\r\n      (action) =>\r\n        action.entryDocumentId === releaseActionArgs.entryDocumentId &&\r\n        action.contentType === releaseActionArgs.contentType &&\r\n        (releaseActionArgs.locale ? action.locale === releaseActionArgs.locale : true)\r\n    );\r\n\r\n    if (isEntryInRelease) {\r\n      throw new AlreadyOnReleaseError(\r\n        `Entry with documentId ${releaseActionArgs.entryDocumentId}${releaseActionArgs.locale ? `( ${releaseActionArgs.locale})` : ''} and contentType ${releaseActionArgs.contentType} already exists in release with id ${releaseId}`\r\n      );\r\n    }\r\n  },\r\n  validateEntryData(\r\n    contentTypeUid: CreateReleaseAction.Request['body']['contentType'],\r\n    entryDocumentId: CreateReleaseAction.Request['body']['entryDocumentId']\r\n  ) {\r\n    const contentType = strapi.contentType(contentTypeUid as UID.ContentType);\r\n\r\n    if (!contentType) {\r\n      throw new errors.NotFoundError(`No content type found for uid ${contentTypeUid}`);\r\n    }\r\n\r\n    if (!contentTypes.hasDraftAndPublish(contentType)) {\r\n      throw new errors.ValidationError(\r\n        `Content type with uid ${contentTypeUid} does not have draftAndPublish enabled`\r\n      );\r\n    }\r\n\r\n    if (contentType.kind === 'collectionType' && !entryDocumentId) {\r\n      throw new errors.ValidationError('Document id is required for collection type');\r\n    }\r\n  },\r\n  async validatePendingReleasesLimit() {\r\n    // Use the maximum releases option if it exists, otherwise default to 3\r\n    const featureCfg = strapi.ee.features.get('cms-content-releases');\r\n\r\n    const maximumPendingReleases =\r\n      (typeof featureCfg === 'object' && featureCfg?.options?.maximumReleases) || 3;\r\n\r\n    const [, pendingReleasesCount] = await strapi.db.query(RELEASE_MODEL_UID).findWithCount({\r\n      filters: {\r\n        releasedAt: {\r\n          $null: true,\r\n        },\r\n      },\r\n    });\r\n\r\n    // Unlimited is a number that will never be reached like 9999\r\n    if (pendingReleasesCount >= maximumPendingReleases) {\r\n      throw new errors.ValidationError('You have reached the maximum number of pending releases');\r\n    }\r\n  },\r\n  async validateUniqueNameForPendingRelease(\r\n    name: CreateRelease.Request['body']['name'],\r\n    id?: UpdateRelease.Request['params']['id']\r\n  ) {\r\n    const pendingReleases = (await strapi.db.query(RELEASE_MODEL_UID).findMany({\r\n      where: {\r\n        releasedAt: {\r\n          $null: true,\r\n        },\r\n        name,\r\n        ...(id && { id: { $ne: id } }),\r\n      },\r\n    })) as Release[];\r\n\r\n    const isNameUnique = pendingReleases.length === 0;\r\n\r\n    if (!isNameUnique) {\r\n      throw new errors.ValidationError(`Release with name ${name} already exists`);\r\n    }\r\n  },\r\n  async validateScheduledAtIsLaterThanNow(\r\n    scheduledAt: CreateRelease.Request['body']['scheduledAt']\r\n  ) {\r\n    if (scheduledAt && new Date(scheduledAt) <= new Date()) {\r\n      throw new errors.ValidationError('Scheduled at must be later than now');\r\n    }\r\n  },\r\n});\r\n\r\nexport default createReleaseValidationService;\r\n","import { scheduleJob, Job } from 'node-schedule';\r\nimport { Core } from '@strapi/types';\r\n\r\nimport { errors } from '@strapi/utils';\r\nimport { Release } from '../../../shared/contracts/releases';\r\nimport { getService } from '../utils';\r\nimport { RELEASE_MODEL_UID } from '../constants';\r\n\r\nconst createSchedulingService = ({ strapi }: { strapi: Core.Strapi }) => {\r\n  const scheduledJobs = new Map<Release['id'], Job>();\r\n\r\n  return {\r\n    async set(releaseId: Release['id'], scheduleDate: Date) {\r\n      const release = await strapi.db\r\n        .query(RELEASE_MODEL_UID)\r\n        .findOne({ where: { id: releaseId, releasedAt: null } });\r\n\r\n      if (!release) {\r\n        throw new errors.NotFoundError(`No release found for id ${releaseId}`);\r\n      }\r\n\r\n      const job = scheduleJob(scheduleDate, async () => {\r\n        try {\r\n          await getService('release', { strapi }).publish(releaseId);\r\n          // @TODO: Trigger webhook with success message\r\n        } catch (error) {\r\n          // @TODO: Trigger webhook with error message\r\n        }\r\n\r\n        this.cancel(releaseId);\r\n      });\r\n\r\n      if (scheduledJobs.has(releaseId)) {\r\n        this.cancel(releaseId);\r\n      }\r\n\r\n      scheduledJobs.set(releaseId, job);\r\n\r\n      return scheduledJobs;\r\n    },\r\n\r\n    cancel(releaseId: Release['id']) {\r\n      if (scheduledJobs.has(releaseId)) {\r\n        scheduledJobs.get(releaseId)!.cancel();\r\n        scheduledJobs.delete(releaseId);\r\n      }\r\n\r\n      return scheduledJobs;\r\n    },\r\n\r\n    getAll() {\r\n      return scheduledJobs;\r\n    },\r\n\r\n    /**\r\n     * On bootstrap, we can use this function to make sure to sync the scheduled jobs from the database that are not yet released\r\n     * This is useful in case the server was restarted and the scheduled jobs were lost\r\n     * This also could be used to sync different Strapi instances in case of a cluster\r\n     */\r\n    async syncFromDatabase() {\r\n      const releases = await strapi.db.query(RELEASE_MODEL_UID).findMany({\r\n        where: {\r\n          scheduledAt: {\r\n            $gte: new Date(),\r\n          },\r\n          releasedAt: null,\r\n        },\r\n      });\r\n\r\n      for (const release of releases) {\r\n        this.set(release.id, release.scheduledAt);\r\n      }\r\n\r\n      return scheduledJobs;\r\n    },\r\n  };\r\n};\r\n\r\nexport default createSchedulingService;\r\n","import type { Core } from '@strapi/types';\r\n\r\nimport type { Settings } from '../../../shared/contracts/settings';\r\n\r\nconst DEFAULT_SETTINGS = {\r\n  defaultTimezone: null,\r\n} satisfies Settings;\r\n\r\nconst createSettingsService = ({ strapi }: { strapi: Core.Strapi }) => {\r\n  const getStore = async () => strapi.store({ type: 'core', name: 'content-releases' });\r\n\r\n  return {\r\n    async update({ settings }: { settings: Settings }): Promise<Settings> {\r\n      const store = await getStore();\r\n      store.set({ key: 'settings', value: settings });\r\n      return settings;\r\n    },\r\n    async find(): Promise<Settings> {\r\n      const store = await getStore();\r\n      const settings = (await store.get({ key: 'settings' })) as Settings | undefined;\r\n\r\n      return {\r\n        ...DEFAULT_SETTINGS,\r\n        ...(settings || {}),\r\n      };\r\n    },\r\n  };\r\n};\r\n\r\nexport type SettingsService = ReturnType<typeof createSettingsService>;\r\n\r\nexport default createSettingsService;\r\n","import release from './release';\r\nimport releaseAction from './release-action';\r\nimport releaseValidation from './validation';\r\nimport scheduling from './scheduling';\r\nimport settings from './settings';\r\n\r\nexport const services = {\r\n  release,\r\n  'release-action': releaseAction,\r\n  'release-validation': releaseValidation,\r\n  scheduling,\r\n  settings,\r\n};\r\n","import { yup, validateYupSchema } from '@strapi/utils';\r\n\r\nexport const RELEASE_SCHEMA = yup\r\n  .object()\r\n  .shape({\r\n    name: yup.string().trim().required(),\r\n    scheduledAt: yup.string().nullable(),\r\n    timezone: yup.string().when('scheduledAt', {\r\n      is: (value: any) => value !== null && value !== undefined,\r\n      then: yup.string().required(),\r\n      otherwise: yup.string().nullable(),\r\n    }),\r\n  })\r\n  .required()\r\n  .noUnknown();\r\n\r\nconst FIND_BY_DOCUMENT_ATTACHED_PARAMS_SCHEMA = yup\r\n  .object()\r\n  .shape({\r\n    contentType: yup.string().required(),\r\n    entryDocumentId: yup.string().nullable(),\r\n    hasEntryAttached: yup.string().nullable(),\r\n    locale: yup.string().nullable(),\r\n  })\r\n  .required()\r\n  .noUnknown();\r\n\r\nexport const validateRelease = validateYupSchema(RELEASE_SCHEMA);\r\n\r\nexport const validatefindByDocumentAttachedParams = validateYupSchema(\r\n  FIND_BY_DOCUMENT_ATTACHED_PARAMS_SCHEMA\r\n);\r\n","import type Koa from 'koa';\r\nimport { errors } from '@strapi/utils';\r\nimport type { Schema } from '@strapi/types';\r\nimport { RELEASE_MODEL_UID } from '../constants';\r\nimport { validateRelease, validatefindByDocumentAttachedParams } from './validation/release';\r\nimport type {\r\n  CreateRelease,\r\n  UpdateRelease,\r\n  PublishRelease,\r\n  GetRelease,\r\n  Release,\r\n  DeleteRelease,\r\n  GetReleases,\r\n  MapEntriesToReleases,\r\n} from '../../../shared/contracts/releases';\r\nimport type { UserInfo } from '../../../shared/types';\r\nimport { getService } from '../utils';\r\n\r\ntype ReleaseWithPopulatedActions = Release & { actions: { count: number } };\r\n\r\nconst releaseController = {\r\n  /**\r\n   * Find releases based on documents attached or not to the release.\r\n   * If `hasEntryAttached` is true, it will return all releases that have the entry attached.\r\n   * If `hasEntryAttached` is false, it will return all releases that don't have the entry attached.\r\n   */\r\n  async findByDocumentAttached(ctx: Koa.Context) {\r\n    const permissionsManager = strapi.service('admin::permission').createPermissionsManager({\r\n      ability: ctx.state.userAbility,\r\n      model: RELEASE_MODEL_UID,\r\n    });\r\n    await permissionsManager.validateQuery(ctx.query);\r\n    const releaseService = getService('release', { strapi });\r\n    const query = await permissionsManager.sanitizeQuery(ctx.query);\r\n\r\n    await validatefindByDocumentAttachedParams(query);\r\n\r\n    // If entry is a singleType, we need to manually add the entryDocumentId to the query\r\n    const model = strapi.getModel(query.contentType) as Schema.ContentType;\r\n    if (model.kind && model.kind === 'singleType') {\r\n      const document = await strapi.db.query(model.uid).findOne({ select: ['documentId'] });\r\n\r\n      if (!document) {\r\n        throw new errors.NotFoundError(`No entry found for contentType ${query.contentType}`);\r\n      }\r\n\r\n      query.entryDocumentId = document.documentId;\r\n    }\r\n\r\n    const { contentType, hasEntryAttached, entryDocumentId, locale } = query;\r\n    const isEntryAttached =\r\n      typeof hasEntryAttached === 'string' ? Boolean(JSON.parse(hasEntryAttached)) : false;\r\n\r\n    if (isEntryAttached) {\r\n      const releases = await releaseService.findMany({\r\n        where: {\r\n          releasedAt: null,\r\n          actions: {\r\n            contentType,\r\n            entryDocumentId: entryDocumentId ?? null,\r\n            locale: locale ?? null,\r\n          },\r\n        },\r\n        populate: {\r\n          actions: {\r\n            fields: ['type'],\r\n            filters: {\r\n              contentType,\r\n              entryDocumentId: entryDocumentId ?? null,\r\n              locale: locale ?? null,\r\n            },\r\n          },\r\n        },\r\n      });\r\n\r\n      ctx.body = { data: releases };\r\n    } else {\r\n      const relatedReleases = await releaseService.findMany({\r\n        where: {\r\n          releasedAt: null,\r\n          actions: {\r\n            contentType,\r\n            entryDocumentId: entryDocumentId ?? null,\r\n            locale: locale ?? null,\r\n          },\r\n        },\r\n      });\r\n\r\n      const releases = await releaseService.findMany({\r\n        where: {\r\n          $or: [\r\n            {\r\n              id: {\r\n                $notIn: relatedReleases.map((release: any) => release.id),\r\n              },\r\n            },\r\n            {\r\n              actions: null,\r\n            },\r\n          ],\r\n          releasedAt: null,\r\n        },\r\n      });\r\n      ctx.body = { data: releases };\r\n    }\r\n  },\r\n\r\n  async findPage(ctx: Koa.Context) {\r\n    const permissionsManager = strapi.service('admin::permission').createPermissionsManager({\r\n      ability: ctx.state.userAbility,\r\n      model: RELEASE_MODEL_UID,\r\n    });\r\n\r\n    await permissionsManager.validateQuery(ctx.query);\r\n\r\n    const releaseService = getService('release', { strapi });\r\n\r\n    const query: GetReleases.Request['query'] = await permissionsManager.sanitizeQuery(ctx.query);\r\n    const { results, pagination } = await releaseService.findPage(query);\r\n\r\n    const data = results.map((release: ReleaseWithPopulatedActions) => {\r\n      const { actions, ...releaseData } = release;\r\n\r\n      return {\r\n        ...releaseData,\r\n        actions: {\r\n          meta: {\r\n            count: actions.count,\r\n          },\r\n        },\r\n      };\r\n    });\r\n\r\n    const pendingReleasesCount = await strapi.db.query(RELEASE_MODEL_UID).count({\r\n      where: {\r\n        releasedAt: null,\r\n      },\r\n    });\r\n\r\n    ctx.body = { data, meta: { pagination, pendingReleasesCount } };\r\n  },\r\n\r\n  async findOne(ctx: Koa.Context) {\r\n    const id: GetRelease.Request['params']['id'] = ctx.params.id;\r\n\r\n    const releaseService = getService('release', { strapi });\r\n    const releaseActionService = getService('release-action', { strapi });\r\n    const release = await releaseService.findOne(id, { populate: ['createdBy'] });\r\n    if (!release) {\r\n      throw new errors.NotFoundError(`Release not found for id: ${id}`);\r\n    }\r\n\r\n    const count = await releaseActionService.countActions({\r\n      filters: {\r\n        release: id,\r\n      },\r\n    });\r\n    const sanitizedRelease = {\r\n      ...release,\r\n      createdBy: release.createdBy\r\n        ? strapi.service('admin::user').sanitizeUser(release.createdBy)\r\n        : null,\r\n    };\r\n\r\n    // Format the data object\r\n    const data = {\r\n      ...sanitizedRelease,\r\n      actions: {\r\n        meta: {\r\n          count,\r\n        },\r\n      },\r\n    };\r\n\r\n    ctx.body = { data };\r\n  },\r\n\r\n  async mapEntriesToReleases(ctx: Koa.Context) {\r\n    const { contentTypeUid, documentIds, locale } = ctx.query;\r\n\r\n    if (!contentTypeUid || !documentIds) {\r\n      throw new errors.ValidationError('Missing required query parameters');\r\n    }\r\n\r\n    const releaseService = getService('release', { strapi });\r\n\r\n    const releasesWithActions = await releaseService.findMany({\r\n      where: {\r\n        releasedAt: null,\r\n        actions: {\r\n          contentType: contentTypeUid,\r\n          entryDocumentId: {\r\n            $in: documentIds,\r\n          },\r\n          locale,\r\n        },\r\n      },\r\n      populate: {\r\n        actions: true,\r\n      },\r\n    });\r\n\r\n    const mappedEntriesInReleases = releasesWithActions.reduce(\r\n      (acc: MapEntriesToReleases.Response['data'], release: Release) => {\r\n        release.actions.forEach((action) => {\r\n          if (action.contentType !== contentTypeUid) {\r\n            return;\r\n          }\r\n\r\n          if (locale && action.locale !== locale) {\r\n            return;\r\n          }\r\n\r\n          if (!acc[action.entryDocumentId]) {\r\n            acc[action.entryDocumentId] = [{ id: release.id, name: release.name }];\r\n          } else {\r\n            acc[action.entryDocumentId].push({ id: release.id, name: release.name });\r\n          }\r\n        });\r\n\r\n        return acc;\r\n      },\r\n      {} as MapEntriesToReleases.Response['data']\r\n    );\r\n\r\n    ctx.body = {\r\n      data: mappedEntriesInReleases,\r\n    };\r\n  },\r\n\r\n  async create(ctx: Koa.Context) {\r\n    const user: UserInfo = ctx.state.user;\r\n    const releaseArgs = ctx.request.body as CreateRelease.Request['body'];\r\n\r\n    await validateRelease(releaseArgs);\r\n\r\n    const releaseService = getService('release', { strapi });\r\n    const release = await releaseService.create(releaseArgs, { user });\r\n\r\n    const permissionsManager = strapi.service('admin::permission').createPermissionsManager({\r\n      ability: ctx.state.userAbility,\r\n      model: RELEASE_MODEL_UID,\r\n    });\r\n\r\n    ctx.created({\r\n      data: await permissionsManager.sanitizeOutput(release),\r\n    });\r\n  },\r\n\r\n  async update(ctx: Koa.Context) {\r\n    const user: UserInfo = ctx.state.user;\r\n    const releaseArgs = ctx.request.body as UpdateRelease.Request['body'];\r\n    const id: UpdateRelease.Request['params']['id'] = ctx.params.id;\r\n\r\n    await validateRelease(releaseArgs);\r\n\r\n    const releaseService = getService('release', { strapi });\r\n    const release = await releaseService.update(id, releaseArgs, { user });\r\n\r\n    const permissionsManager = strapi.service('admin::permission').createPermissionsManager({\r\n      ability: ctx.state.userAbility,\r\n      model: RELEASE_MODEL_UID,\r\n    });\r\n\r\n    ctx.body = {\r\n      data: await permissionsManager.sanitizeOutput(release),\r\n    };\r\n  },\r\n\r\n  async delete(ctx: Koa.Context) {\r\n    const id: DeleteRelease.Request['params']['id'] = ctx.params.id;\r\n\r\n    const releaseService = getService('release', { strapi });\r\n    const release = await releaseService.delete(id);\r\n\r\n    ctx.body = {\r\n      data: release,\r\n    };\r\n  },\r\n\r\n  async publish(ctx: Koa.Context) {\r\n    const id: PublishRelease.Request['params']['id'] = ctx.params.id;\r\n\r\n    const releaseService = getService('release', { strapi });\r\n    const releaseActionService = getService('release-action', { strapi });\r\n    const release = await releaseService.publish(id);\r\n\r\n    const [countPublishActions, countUnpublishActions] = await Promise.all([\r\n      releaseActionService.countActions({\r\n        filters: {\r\n          release: id,\r\n          type: 'publish',\r\n        },\r\n      }),\r\n      releaseActionService.countActions({\r\n        filters: {\r\n          release: id,\r\n          type: 'unpublish',\r\n        },\r\n      }),\r\n    ]);\r\n\r\n    ctx.body = {\r\n      data: release,\r\n      meta: {\r\n        totalEntries: countPublishActions + countUnpublishActions,\r\n        totalPublishedEntries: countPublishActions,\r\n        totalUnpublishedEntries: countUnpublishActions,\r\n      },\r\n    };\r\n  },\r\n};\r\n\r\nexport default releaseController;\r\n","import { yup, validateYupSchema } from '@strapi/utils';\r\n\r\nconst RELEASE_ACTION_SCHEMA = yup.object().shape({\r\n  contentType: yup.string().required(),\r\n  entryDocumentId: yup.strapiID(),\r\n  locale: yup.string(),\r\n  type: yup.string().oneOf(['publish', 'unpublish']).required(),\r\n});\r\n\r\nconst RELEASE_ACTION_UPDATE_SCHEMA = yup.object().shape({\r\n  type: yup.string().oneOf(['publish', 'unpublish']).required(),\r\n});\r\n\r\nconst FIND_MANY_ACTIONS_PARAMS = yup.object().shape({\r\n  groupBy: yup.string().oneOf(['action', 'contentType', 'locale']),\r\n});\r\n\r\nexport const validateReleaseAction = validateYupSchema(RELEASE_ACTION_SCHEMA);\r\nexport const validateReleaseActionUpdateSchema = validateYupSchema(RELEASE_ACTION_UPDATE_SCHEMA);\r\nexport const validateFindManyActionsParams = validateYupSchema(FIND_MANY_ACTIONS_PARAMS);\r\n","import type Koa from 'koa';\r\n\r\nimport { async } from '@strapi/utils';\r\nimport {\r\n  validateReleaseAction,\r\n  validateReleaseActionUpdateSchema,\r\n  validateFindManyActionsParams,\r\n} from './validation/release-action';\r\nimport type {\r\n  CreateReleaseAction,\r\n  CreateManyReleaseActions,\r\n  GetReleaseActions,\r\n  UpdateReleaseAction,\r\n  DeleteReleaseAction,\r\n} from '../../../shared/contracts/release-actions';\r\nimport { getService } from '../utils';\r\nimport { RELEASE_ACTION_MODEL_UID } from '../constants';\r\nimport { AlreadyOnReleaseError } from '../services/validation';\r\n\r\nconst releaseActionController = {\r\n  async create(ctx: Koa.Context) {\r\n    const releaseId: CreateReleaseAction.Request['params']['releaseId'] = ctx.params.releaseId;\r\n    const releaseActionArgs = ctx.request.body as CreateReleaseAction.Request['body'];\r\n\r\n    await validateReleaseAction(releaseActionArgs);\r\n\r\n    const releaseActionService = getService('release-action', { strapi });\r\n    const releaseAction = await releaseActionService.create(releaseId, releaseActionArgs);\r\n\r\n    ctx.created({\r\n      data: releaseAction,\r\n    });\r\n  },\r\n\r\n  async createMany(ctx: Koa.Context) {\r\n    const releaseId: CreateManyReleaseActions.Request['params']['releaseId'] = ctx.params.releaseId;\r\n    const releaseActionsArgs = ctx.request.body as CreateManyReleaseActions.Request['body'];\r\n\r\n    await Promise.all(\r\n      releaseActionsArgs.map((releaseActionArgs) => validateReleaseAction(releaseActionArgs))\r\n    );\r\n\r\n    const releaseActionService = getService('release-action', { strapi });\r\n    const releaseService = getService('release', { strapi });\r\n\r\n    const releaseActions = await strapi.db.transaction(async () => {\r\n      const releaseActions = await Promise.all(\r\n        releaseActionsArgs.map(async (releaseActionArgs) => {\r\n          try {\r\n            const action = await releaseActionService.create(releaseId, releaseActionArgs, {\r\n              disableUpdateReleaseStatus: true,\r\n            });\r\n            return action;\r\n          } catch (error) {\r\n            // If the entry is already in the release, we don't want to throw an error, so we catch and ignore it\r\n            if (error instanceof AlreadyOnReleaseError) {\r\n              return null;\r\n            }\r\n            throw error;\r\n          }\r\n        })\r\n      );\r\n      return releaseActions;\r\n    });\r\n\r\n    const newReleaseActions = releaseActions.filter((action) => action !== null);\r\n\r\n    if (newReleaseActions.length > 0) {\r\n      releaseService.updateReleaseStatus(releaseId);\r\n    }\r\n\r\n    ctx.created({\r\n      data: newReleaseActions,\r\n      meta: {\r\n        entriesAlreadyInRelease: releaseActions.length - newReleaseActions.length,\r\n        totalEntries: releaseActions.length,\r\n      },\r\n    });\r\n  },\r\n\r\n  async findMany(ctx: Koa.Context) {\r\n    const releaseId: GetReleaseActions.Request['params']['releaseId'] = ctx.params.releaseId;\r\n    const permissionsManager = strapi.service('admin::permission').createPermissionsManager({\r\n      ability: ctx.state.userAbility,\r\n      model: RELEASE_ACTION_MODEL_UID,\r\n    });\r\n\r\n    await validateFindManyActionsParams(ctx.query);\r\n\r\n    if (ctx.query.groupBy) {\r\n      if (!['action', 'contentType', 'locale'].includes(ctx.query.groupBy as string)) {\r\n        ctx.badRequest('Invalid groupBy parameter');\r\n      }\r\n    }\r\n\r\n    ctx.query.sort = ctx.query.groupBy === 'action' ? 'type' : ctx.query.groupBy;\r\n    delete ctx.query.groupBy;\r\n\r\n    const query = await permissionsManager.sanitizeQuery(ctx.query);\r\n\r\n    const releaseActionService = getService('release-action', { strapi });\r\n    const { results, pagination } = await releaseActionService.findPage(releaseId, {\r\n      ...query,\r\n    });\r\n\r\n    /**\r\n     * Release actions can be related to entries of different content types.\r\n     * We need to sanitize the entry output according to that content type.\r\n     * So, we group the sanitized output function by content type.\r\n     */\r\n    const contentTypeOutputSanitizers = results.reduce((acc: Record<string, any>, action: any) => {\r\n      if (acc[action.contentType]) {\r\n        return acc;\r\n      }\r\n\r\n      const contentTypePermissionsManager = strapi\r\n        .service('admin::permission')\r\n        .createPermissionsManager({\r\n          ability: ctx.state.userAbility,\r\n          model: action.contentType,\r\n        });\r\n\r\n      acc[action.contentType] = contentTypePermissionsManager.sanitizeOutput;\r\n\r\n      return acc;\r\n    }, {});\r\n\r\n    /**\r\n     * sanitizeOutput doesn't work if you use it directly on the Release Action model, it doesn't sanitize the entries\r\n     * So, we need to sanitize manually each entry inside a Release Action\r\n     */\r\n    const sanitizedResults = await async.map(results, async (action: any) => ({\r\n      ...action,\r\n      entry: action.entry\r\n        ? await contentTypeOutputSanitizers[action.contentType](action.entry)\r\n        : {},\r\n    }));\r\n\r\n    const groupedData = await releaseActionService.groupActions(sanitizedResults, query.sort);\r\n\r\n    const contentTypes = await releaseActionService.getContentTypeModelsFromActions(results);\r\n\r\n    const releaseService = getService('release', { strapi });\r\n    const components = await releaseService.getAllComponents();\r\n\r\n    ctx.body = {\r\n      data: groupedData,\r\n      meta: {\r\n        pagination,\r\n        contentTypes,\r\n        components,\r\n      },\r\n    };\r\n  },\r\n\r\n  async update(ctx: Koa.Context) {\r\n    const actionId: UpdateReleaseAction.Request['params']['actionId'] = ctx.params.actionId;\r\n    const releaseId: UpdateReleaseAction.Request['params']['releaseId'] = ctx.params.releaseId;\r\n    const releaseActionUpdateArgs = ctx.request.body as UpdateReleaseAction.Request['body'];\r\n\r\n    await validateReleaseActionUpdateSchema(releaseActionUpdateArgs);\r\n\r\n    const releaseActionService = getService('release-action', { strapi });\r\n\r\n    const updatedAction = await releaseActionService.update(\r\n      actionId,\r\n      releaseId,\r\n      releaseActionUpdateArgs\r\n    );\r\n\r\n    ctx.body = {\r\n      data: updatedAction,\r\n    };\r\n  },\r\n\r\n  async delete(ctx: Koa.Context) {\r\n    const actionId: DeleteReleaseAction.Request['params']['actionId'] = ctx.params.actionId;\r\n    const releaseId: DeleteReleaseAction.Request['params']['releaseId'] = ctx.params.releaseId;\r\n\r\n    const releaseActionService = getService('release-action', { strapi });\r\n\r\n    const deletedReleaseAction = await releaseActionService.delete(actionId, releaseId);\r\n\r\n    ctx.body = {\r\n      data: deletedReleaseAction,\r\n    };\r\n  },\r\n};\r\n\r\nexport default releaseActionController;\r\n","import { validateYupSchema } from '@strapi/utils';\r\nimport * as yup from 'yup';\r\n\r\nexport const SETTINGS_SCHEMA = yup\r\n  .object()\r\n  .shape({\r\n    defaultTimezone: yup.string().nullable().default(null),\r\n  })\r\n  .required()\r\n  .noUnknown();\r\n\r\nexport const validateSettings = validateYupSchema(SETTINGS_SCHEMA);\r\n","/**\r\n * Used to store user configurations related to releases.\r\n * E.g the default timezone for the release schedule.\r\n */\r\nimport type Koa from 'koa';\r\n\r\nimport type { GetSettings, UpdateSettings, Settings } from '../../../shared/contracts/settings';\r\nimport { getService } from '../utils';\r\nimport { validateSettings } from './validation/settings';\r\n\r\nconst settingsController = {\r\n  async find(ctx: Koa.Context) {\r\n    // Get settings\r\n    const settingsService = getService('settings', { strapi });\r\n    const settings = await settingsService.find();\r\n\r\n    // Response\r\n    ctx.body = { data: settings } satisfies GetSettings.Response;\r\n  },\r\n\r\n  async update(ctx: Koa.Context) {\r\n    // Data validation\r\n    const settingsBody = ctx.request.body;\r\n    const settings = (await validateSettings(settingsBody)) as Settings;\r\n\r\n    // Update\r\n    const settingsService = getService('settings', { strapi });\r\n    const updatedSettings = await settingsService.update({ settings });\r\n\r\n    // Response\r\n    ctx.body = { data: updatedSettings } satisfies UpdateSettings.Response;\r\n  },\r\n};\r\n\r\nexport default settingsController;\r\n","import release from './release';\r\nimport releaseAction from './release-action';\r\nimport settings from './settings';\r\n\r\nexport const controllers = {\r\n  release,\r\n  'release-action': releaseAction,\r\n  settings,\r\n};\r\n","export default {\r\n  type: 'admin',\r\n  routes: [\r\n    {\r\n      method: 'GET',\r\n      path: '/mapEntriesToReleases',\r\n      handler: 'release.mapEntriesToReleases',\r\n      config: {\r\n        policies: [\r\n          'admin::isAuthenticatedAdmin',\r\n          {\r\n            name: 'admin::hasPermissions',\r\n            config: {\r\n              actions: ['plugin::content-releases.read'],\r\n            },\r\n          },\r\n        ],\r\n      },\r\n    },\r\n    {\r\n      method: 'GET',\r\n      path: '/getByDocumentAttached',\r\n      handler: 'release.findByDocumentAttached',\r\n      config: {\r\n        policies: [\r\n          'admin::isAuthenticatedAdmin',\r\n          {\r\n            name: 'admin::hasPermissions',\r\n            config: {\r\n              actions: ['plugin::content-releases.read'],\r\n            },\r\n          },\r\n        ],\r\n      },\r\n    },\r\n    {\r\n      method: 'POST',\r\n      path: '/',\r\n      handler: 'release.create',\r\n      config: {\r\n        policies: [\r\n          'admin::isAuthenticatedAdmin',\r\n          {\r\n            name: 'admin::hasPermissions',\r\n            config: {\r\n              actions: ['plugin::content-releases.create'],\r\n            },\r\n          },\r\n        ],\r\n      },\r\n    },\r\n    {\r\n      method: 'GET',\r\n      path: '/',\r\n      handler: 'release.findPage',\r\n      config: {\r\n        policies: [\r\n          'admin::isAuthenticatedAdmin',\r\n          {\r\n            name: 'admin::hasPermissions',\r\n            config: {\r\n              actions: ['plugin::content-releases.read'],\r\n            },\r\n          },\r\n        ],\r\n      },\r\n    },\r\n    {\r\n      method: 'GET',\r\n      path: '/:id',\r\n      handler: 'release.findOne',\r\n      config: {\r\n        policies: [\r\n          'admin::isAuthenticatedAdmin',\r\n          {\r\n            name: 'admin::hasPermissions',\r\n            config: {\r\n              actions: ['plugin::content-releases.read'],\r\n            },\r\n          },\r\n        ],\r\n      },\r\n    },\r\n    {\r\n      method: 'PUT',\r\n      path: '/:id',\r\n      handler: 'release.update',\r\n      config: {\r\n        policies: [\r\n          'admin::isAuthenticatedAdmin',\r\n          {\r\n            name: 'admin::hasPermissions',\r\n            config: {\r\n              actions: ['plugin::content-releases.update'],\r\n            },\r\n          },\r\n        ],\r\n      },\r\n    },\r\n    {\r\n      method: 'DELETE',\r\n      path: '/:id',\r\n      handler: 'release.delete',\r\n      config: {\r\n        policies: [\r\n          'admin::isAuthenticatedAdmin',\r\n          {\r\n            name: 'admin::hasPermissions',\r\n            config: {\r\n              actions: ['plugin::content-releases.delete'],\r\n            },\r\n          },\r\n        ],\r\n      },\r\n    },\r\n    {\r\n      method: 'POST',\r\n      path: '/:id/publish',\r\n      handler: 'release.publish',\r\n      config: {\r\n        policies: [\r\n          'admin::isAuthenticatedAdmin',\r\n          {\r\n            name: 'admin::hasPermissions',\r\n            config: {\r\n              actions: ['plugin::content-releases.publish'],\r\n            },\r\n          },\r\n        ],\r\n      },\r\n    },\r\n  ],\r\n};\r\n","export default {\r\n  type: 'admin',\r\n  routes: [\r\n    {\r\n      method: 'POST',\r\n      path: '/:releaseId/actions',\r\n      handler: 'release-action.create',\r\n      config: {\r\n        policies: [\r\n          'admin::isAuthenticatedAdmin',\r\n          {\r\n            name: 'admin::hasPermissions',\r\n            config: {\r\n              actions: ['plugin::content-releases.create-action'],\r\n            },\r\n          },\r\n        ],\r\n      },\r\n    },\r\n    {\r\n      method: 'POST',\r\n      path: '/:releaseId/actions/bulk',\r\n      handler: 'release-action.createMany',\r\n      config: {\r\n        policies: [\r\n          'admin::isAuthenticatedAdmin',\r\n          {\r\n            name: 'admin::hasPermissions',\r\n            config: {\r\n              actions: ['plugin::content-releases.create-action'],\r\n            },\r\n          },\r\n        ],\r\n      },\r\n    },\r\n    {\r\n      method: 'GET',\r\n      path: '/:releaseId/actions',\r\n      handler: 'release-action.findMany',\r\n      config: {\r\n        policies: [\r\n          'admin::isAuthenticatedAdmin',\r\n          {\r\n            name: 'admin::hasPermissions',\r\n            config: {\r\n              actions: ['plugin::content-releases.read'],\r\n            },\r\n          },\r\n        ],\r\n      },\r\n    },\r\n    {\r\n      method: 'PUT',\r\n      path: '/:releaseId/actions/:actionId',\r\n      handler: 'release-action.update',\r\n      config: {\r\n        policies: [\r\n          'admin::isAuthenticatedAdmin',\r\n          {\r\n            name: 'admin::hasPermissions',\r\n            config: {\r\n              actions: ['plugin::content-releases.update'],\r\n            },\r\n          },\r\n        ],\r\n      },\r\n    },\r\n    {\r\n      method: 'DELETE',\r\n      path: '/:releaseId/actions/:actionId',\r\n      handler: 'release-action.delete',\r\n      config: {\r\n        policies: [\r\n          'admin::isAuthenticatedAdmin',\r\n          {\r\n            name: 'admin::hasPermissions',\r\n            config: {\r\n              actions: ['plugin::content-releases.delete-action'],\r\n            },\r\n          },\r\n        ],\r\n      },\r\n    },\r\n  ],\r\n};\r\n","export default {\r\n  type: 'admin',\r\n  routes: [\r\n    {\r\n      method: 'GET',\r\n      path: '/settings',\r\n      handler: 'settings.find',\r\n      config: {\r\n        policies: [\r\n          'admin::isAuthenticatedAdmin',\r\n          {\r\n            name: 'admin::hasPermissions',\r\n            config: {\r\n              actions: ['plugin::content-releases.settings.read'],\r\n            },\r\n          },\r\n        ],\r\n      },\r\n    },\r\n\r\n    {\r\n      method: 'PUT',\r\n      path: '/settings',\r\n      handler: 'settings.update',\r\n      config: {\r\n        policies: [\r\n          'admin::isAuthenticatedAdmin',\r\n          {\r\n            name: 'admin::hasPermissions',\r\n            config: {\r\n              actions: ['plugin::content-releases.settings.update'],\r\n            },\r\n          },\r\n        ],\r\n      },\r\n    },\r\n  ],\r\n};\r\n","import release from './release';\r\nimport releaseAction from './release-action';\r\nimport settings from './settings';\r\n\r\nexport const routes = {\r\n  settings,\r\n  release,\r\n  'release-action': releaseAction,\r\n};\r\n","/* eslint-disable @typescript-eslint/no-var-requires */\r\nimport { register } from './register';\r\nimport { bootstrap } from './bootstrap';\r\nimport { destroy } from './destroy';\r\nimport { contentTypes } from './content-types';\r\nimport { services } from './services';\r\nimport { controllers } from './controllers';\r\nimport { routes } from './routes';\r\n\r\nconst getPlugin = () => {\r\n  if (strapi.ee.features.isEnabled('cms-content-releases')) {\r\n    return {\r\n      register,\r\n      bootstrap,\r\n      destroy,\r\n      contentTypes,\r\n      services,\r\n      controllers,\r\n      routes,\r\n    };\r\n  }\r\n\r\n  return {\r\n    // Always return register, it handles its own feature check\r\n    register,\r\n    // Always return contentTypes to avoid losing data when the feature is disabled\r\n    contentTypes,\r\n  };\r\n};\r\n\r\nexport default getPlugin();\r\n"],"names":["strapi","contentTypes","contentTypesUtils","difference","keys","async","release","isEntryValid","isEqual","schema","releaseAction","errors","setCreatorFields","error","_","scheduleJob","settings","releaseValidation","scheduling","yup","validateYupSchema","releaseActions"],"mappings":"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"}