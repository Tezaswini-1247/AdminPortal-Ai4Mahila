{"version":3,"file":"load-files.js","sources":["../../src/utils/load-files.ts"],"sourcesContent":["import path from 'path';\r\nimport _ from 'lodash';\r\nimport fse from 'fs-extra';\r\n\r\nimport { importDefault } from '@strapi/utils';\r\nimport { glob } from 'glob';\r\nimport { filePathToPropPath } from './filepath-to-prop-path';\r\n\r\n/**\r\n * Returns an Object build from a list of files matching a glob pattern in a directory\r\n * It builds a tree structure resembling the folder structure in dir\r\n */\r\nexport const loadFiles = async <T extends object>(\r\n  dir: string,\r\n  pattern: string,\r\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n  { requireFn = importDefault, shouldUseFileNameAsKey = (_: any) => true, globArgs = {} } = {}\r\n): Promise<T> => {\r\n  const root = {};\r\n  const files = await glob(pattern, { cwd: dir, ...globArgs });\r\n\r\n  for (const file of files) {\r\n    const absolutePath = path.resolve(dir, file);\r\n\r\n    // load module\r\n    delete require.cache[absolutePath];\r\n    let mod;\r\n\r\n    if (path.extname(absolutePath) === '.json') {\r\n      mod = await fse.readJson(absolutePath);\r\n    } else {\r\n      mod = requireFn(absolutePath);\r\n    }\r\n\r\n    Object.defineProperty(mod, '__filename__', {\r\n      enumerable: true,\r\n      configurable: false,\r\n      writable: false,\r\n      value: path.basename(file),\r\n    });\r\n\r\n    const propPath = filePathToPropPath(file, shouldUseFileNameAsKey(file));\r\n\r\n    if (propPath.length === 0) _.merge(root, mod);\r\n    _.merge(root, _.setWith({}, propPath, mod, Object));\r\n  }\r\n\r\n  return root as T;\r\n};\r\n"],"names":["importDefault","_","glob","path","fse","filePathToPropPath"],"mappings":";;;;;;;;;;;;AAYO,MAAM,YAAY,OACvB,KACA,SAEA,EAAE,YAAYA,YAAe,eAAA,yBAAyB,CAACC,OAAW,MAAM,WAAW,CAAG,EAAA,IAAI,CAAA,MAC3E;AACf,QAAM,OAAO,CAAC;AACR,QAAA,QAAQ,MAAMC,KAAAA,KAAK,SAAS,EAAE,KAAK,KAAK,GAAG,UAAU;AAE3D,aAAW,QAAQ,OAAO;AACxB,UAAM,eAAeC,cAAA,QAAK,QAAQ,KAAK,IAAI;AAGpC,WAAA,QAAQ,MAAM,YAAY;AAC7B,QAAA;AAEJ,QAAIA,sBAAK,QAAQ,YAAY,MAAM,SAAS;AACpC,YAAA,MAAMC,aAAAA,QAAI,SAAS,YAAY;AAAA,IAAA,OAChC;AACL,YAAM,UAAU,YAAY;AAAA,IAAA;AAGvB,WAAA,eAAe,KAAK,gBAAgB;AAAA,MACzC,YAAY;AAAA,MACZ,cAAc;AAAA,MACd,UAAU;AAAA,MACV,OAAOD,cAAAA,QAAK,SAAS,IAAI;AAAA,IAAA,CAC1B;AAED,UAAM,WAAWE,mBAAA,mBAAmB,MAAM,uBAAuB,IAAI,CAAC;AAEtE,QAAI,SAAS,WAAW,EAAKJ,YAAA,QAAA,MAAM,MAAM,GAAG;AAC1CA,uBAAA,MAAM,MAAMA,mBAAE,QAAQ,CAAA,GAAI,UAAU,KAAK,MAAM,CAAC;AAAA,EAAA;AAG7C,SAAA;AACT;;"}