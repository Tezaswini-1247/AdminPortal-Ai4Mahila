{"version":3,"file":"modules.js","sources":["../../src/registries/modules.ts"],"sourcesContent":["import { pickBy, has } from 'lodash/fp';\r\nimport type { Core } from '@strapi/types';\r\nimport { createModule, RawModule, Module } from '../domain/module';\r\n\r\ntype ModuleMap = { [namespace: string]: Module };\r\n\r\nconst modulesRegistry = (strapi: Core.Strapi) => {\r\n  const modules: ModuleMap = {};\r\n\r\n  return {\r\n    get(namespace: string) {\r\n      return modules[namespace];\r\n    },\r\n    getAll(prefix = '') {\r\n      return pickBy<ModuleMap>((mod, namespace) => namespace.startsWith(prefix))(modules);\r\n    },\r\n    add(namespace: string, rawModule: RawModule) {\r\n      if (has(namespace, modules)) {\r\n        throw new Error(`Module ${namespace} has already been registered.`);\r\n      }\r\n\r\n      modules[namespace] = createModule(namespace, rawModule, strapi);\r\n      modules[namespace].load();\r\n\r\n      return modules[namespace];\r\n    },\r\n    async bootstrap() {\r\n      for (const mod of Object.values(modules)) {\r\n        await mod.bootstrap();\r\n      }\r\n    },\r\n    async register() {\r\n      for (const mod of Object.values(modules)) {\r\n        await mod.register();\r\n      }\r\n    },\r\n    async destroy() {\r\n      for (const mod of Object.values(modules)) {\r\n        await mod.destroy();\r\n      }\r\n    },\r\n  };\r\n};\r\n\r\nexport default modulesRegistry;\r\n"],"names":["pickBy","has","createModule"],"mappings":";;;AAMM,MAAA,kBAAkB,CAAC,WAAwB;AAC/C,QAAM,UAAqB,CAAC;AAErB,SAAA;AAAA,IACL,IAAI,WAAmB;AACrB,aAAO,QAAQ,SAAS;AAAA,IAC1B;AAAA,IACA,OAAO,SAAS,IAAI;AACX,aAAAA,GAAA,OAAkB,CAAC,KAAK,cAAc,UAAU,WAAW,MAAM,CAAC,EAAE,OAAO;AAAA,IACpF;AAAA,IACA,IAAI,WAAmB,WAAsB;AACvC,UAAAC,GAAA,IAAI,WAAW,OAAO,GAAG;AAC3B,cAAM,IAAI,MAAM,UAAU,SAAS,+BAA+B;AAAA,MAAA;AAGpE,cAAQ,SAAS,IAAIC,MAAAA,aAAa,WAAW,WAAW,MAAM;AACtD,cAAA,SAAS,EAAE,KAAK;AAExB,aAAO,QAAQ,SAAS;AAAA,IAC1B;AAAA,IACA,MAAM,YAAY;AAChB,iBAAW,OAAO,OAAO,OAAO,OAAO,GAAG;AACxC,cAAM,IAAI,UAAU;AAAA,MAAA;AAAA,IAExB;AAAA,IACA,MAAM,WAAW;AACf,iBAAW,OAAO,OAAO,OAAO,OAAO,GAAG;AACxC,cAAM,IAAI,SAAS;AAAA,MAAA;AAAA,IAEvB;AAAA,IACA,MAAM,UAAU;AACd,iBAAW,OAAO,OAAO,OAAO,OAAO,GAAG;AACxC,cAAM,IAAI,QAAQ;AAAA,MAAA;AAAA,IACpB;AAAA,EAEJ;AACF;;"}