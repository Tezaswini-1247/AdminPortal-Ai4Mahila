{"version":3,"file":"command.js","sources":["../../../../src/cli/commands/transfer/command.ts"],"sourcesContent":["import inquirer from 'inquirer';\r\nimport { createCommand, Option } from 'commander';\r\nimport { getCommanderConfirmMessage, forceOption, parseURL } from '../../utils/commander';\r\nimport { exitWith, assertUrlHasProtocol, ifOptions } from '../../utils/helpers';\r\nimport {\r\n  excludeOption,\r\n  onlyOption,\r\n  throttleOption,\r\n  validateExcludeOnly,\r\n} from '../../utils/data-transfer';\r\n\r\nimport action from './action';\r\n\r\n/**\r\n * `$ strapi transfer`\r\n */\r\nconst command = () => {\r\n  return (\r\n    createCommand('transfer')\r\n      .description('Transfer data from one source to another')\r\n      .allowExcessArguments(false)\r\n      .addOption(\r\n        new Option(\r\n          '--from <sourceURL>',\r\n          `URL of the remote Strapi instance to get data from`\r\n        ).argParser(parseURL)\r\n      )\r\n      .addOption(new Option('--from-token <token>', `Transfer token for the remote Strapi source`))\r\n      .addOption(\r\n        new Option(\r\n          '--to <destinationURL>',\r\n          `URL of the remote Strapi instance to send data to`\r\n        ).argParser(parseURL)\r\n      )\r\n\r\n      .addOption(\r\n        new Option('--to-token <token>', `Transfer token for the remote Strapi destination`)\r\n      )\r\n      .addOption(new Option('--verbose', 'Enable verbose logs'))\r\n      .addOption(forceOption)\r\n      .addOption(excludeOption)\r\n      .addOption(onlyOption)\r\n      .addOption(throttleOption)\r\n      .hook('preAction', validateExcludeOnly)\r\n      .hook(\r\n        'preAction',\r\n        ifOptions(\r\n          (opts) => !(opts.from || opts.to) || (opts.from && opts.to),\r\n          async () =>\r\n            exitWith(\r\n              1,\r\n              'Exactly one remote source (from) or destination (to) option must be provided'\r\n            )\r\n        )\r\n      )\r\n      // If --from is used, validate the URL and token\r\n      .hook(\r\n        'preAction',\r\n        ifOptions(\r\n          (opts) => opts.from,\r\n          async (thisCommand) => {\r\n            assertUrlHasProtocol(thisCommand.opts().from, ['https:', 'http:']);\r\n            if (!thisCommand.opts().fromToken) {\r\n              const answers = await inquirer.prompt([\r\n                {\r\n                  type: 'password',\r\n                  message: 'Please enter your transfer token for the remote Strapi source',\r\n                  name: 'fromToken',\r\n                },\r\n              ]);\r\n              if (!answers.fromToken?.length) {\r\n                exitWith(1, 'No token provided for remote source, aborting transfer.');\r\n              }\r\n              thisCommand.opts().fromToken = answers.fromToken;\r\n            }\r\n\r\n            await getCommanderConfirmMessage(\r\n              'The transfer will delete all the local Strapi assets and its database. Are you sure you want to proceed?',\r\n              { failMessage: 'Transfer process aborted' }\r\n            )(thisCommand);\r\n          }\r\n        )\r\n      )\r\n      // If --to is used, validate the URL, token, and confirm restore\r\n      .hook(\r\n        'preAction',\r\n        ifOptions(\r\n          (opts) => opts.to,\r\n          async (thisCommand) => {\r\n            assertUrlHasProtocol(thisCommand.opts().to, ['https:', 'http:']);\r\n            if (!thisCommand.opts().toToken) {\r\n              const answers = await inquirer.prompt([\r\n                {\r\n                  type: 'password',\r\n                  message: 'Please enter your transfer token for the remote Strapi destination',\r\n                  name: 'toToken',\r\n                },\r\n              ]);\r\n              if (!answers.toToken?.length) {\r\n                exitWith(1, 'No token provided for remote destination, aborting transfer.');\r\n              }\r\n              thisCommand.opts().toToken = answers.toToken;\r\n            }\r\n\r\n            await getCommanderConfirmMessage(\r\n              'The transfer will delete existing data from the remote Strapi! Are you sure you want to proceed?',\r\n              { failMessage: 'Transfer process aborted' }\r\n            )(thisCommand);\r\n          }\r\n        )\r\n      )\r\n      .action(action)\r\n  );\r\n};\r\n\r\nexport default command;\r\n"],"names":["createCommand","Option","parseURL","forceOption","excludeOption","onlyOption","throttleOption","validateExcludeOnly","ifOptions","exitWith","assertUrlHasProtocol","inquirer","getCommanderConfirmMessage"],"mappings":";;;;;;;;;AAgBA,MAAM,UAAU,MAAM;AAElB,SAAAA,UAAA,cAAc,UAAU,EACrB,YAAY,0CAA0C,EACtD,qBAAqB,KAAK,EAC1B;AAAA,IACC,IAAIC,UAAA;AAAA,MACF;AAAA,MACA;AAAA,IACF,EAAE,UAAUC,YAAQ,QAAA;AAAA,EAAA,EAErB,UAAU,IAAID,iBAAO,wBAAwB,6CAA6C,CAAC,EAC3F;AAAA,IACC,IAAIA,UAAA;AAAA,MACF;AAAA,MACA;AAAA,IACF,EAAE,UAAUC,YAAQ,QAAA;AAAA,EAAA,EAGrB;AAAA,IACC,IAAID,UAAO,OAAA,sBAAsB,kDAAkD;AAAA,EAAA,EAEpF,UAAU,IAAIA,UAAAA,OAAO,aAAa,qBAAqB,CAAC,EACxD,UAAUE,YAAW,WAAA,EACrB,UAAUC,aAAa,aAAA,EACvB,UAAUC,uBAAU,EACpB,UAAUC,aAAAA,cAAc,EACxB,KAAK,aAAaC,aAAmB,mBAAA,EACrC;AAAA,IACC;AAAA,IACAC,QAAA;AAAA,MACE,CAAC,SAAS,EAAE,KAAK,QAAQ,KAAK,OAAQ,KAAK,QAAQ,KAAK;AAAA,MACxD,YACEC,QAAA;AAAA,QACE;AAAA,QACA;AAAA,MAAA;AAAA,IACF;AAAA,EACJ,EAGD;AAAA,IACC;AAAA,IACAD,QAAA;AAAA,MACE,CAAC,SAAS,KAAK;AAAA,MACf,OAAO,gBAAgB;AACrBE,gBAAA,qBAAqB,YAAY,KAAK,EAAE,MAAM,CAAC,UAAU,OAAO,CAAC;AACjE,YAAI,CAAC,YAAY,KAAK,EAAE,WAAW;AAC3B,gBAAA,UAAU,MAAMC,kBAAA,QAAS,OAAO;AAAA,YACpC;AAAA,cACE,MAAM;AAAA,cACN,SAAS;AAAA,cACT,MAAM;AAAA,YAAA;AAAA,UACR,CACD;AACG,cAAA,CAAC,QAAQ,WAAW,QAAQ;AAC9BF,oBAAA,SAAS,GAAG,yDAAyD;AAAA,UAAA;AAE3D,sBAAA,KAAA,EAAO,YAAY,QAAQ;AAAA,QAAA;AAGnC,cAAAG,YAAA;AAAA,UACJ;AAAA,UACA,EAAE,aAAa,2BAA2B;AAAA,UAC1C,WAAW;AAAA,MAAA;AAAA,IACf;AAAA,EACF,EAGD;AAAA,IACC;AAAA,IACAJ,QAAA;AAAA,MACE,CAAC,SAAS,KAAK;AAAA,MACf,OAAO,gBAAgB;AACrBE,gBAAA,qBAAqB,YAAY,KAAK,EAAE,IAAI,CAAC,UAAU,OAAO,CAAC;AAC/D,YAAI,CAAC,YAAY,KAAK,EAAE,SAAS;AACzB,gBAAA,UAAU,MAAMC,kBAAA,QAAS,OAAO;AAAA,YACpC;AAAA,cACE,MAAM;AAAA,cACN,SAAS;AAAA,cACT,MAAM;AAAA,YAAA;AAAA,UACR,CACD;AACG,cAAA,CAAC,QAAQ,SAAS,QAAQ;AAC5BF,oBAAA,SAAS,GAAG,8DAA8D;AAAA,UAAA;AAEhE,sBAAA,KAAA,EAAO,UAAU,QAAQ;AAAA,QAAA;AAGjC,cAAAG,YAAA;AAAA,UACJ;AAAA,UACA,EAAE,aAAa,2BAA2B;AAAA,UAC1C,WAAW;AAAA,MAAA;AAAA,IACf;AAAA,EACF,EAED,OAAO,MAAM;AAEpB;;"}