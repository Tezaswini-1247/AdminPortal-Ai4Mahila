{"version":3,"file":"useDragAndDrop-BMtgCYzL.js","sources":["../../admin/src/constants/dragAndDrop.ts","../../admin/src/hooks/useKeyboardDragAndDrop.ts","../../admin/src/hooks/useDragAndDrop.ts"],"sourcesContent":["export const ItemTypes = {\r\n  COMPONENT: 'component',\r\n  EDIT_FIELD: 'editField',\r\n  FIELD: 'field',\r\n  DYNAMIC_ZONE: 'dynamicZone',\r\n  RELATION: 'relation',\r\n  BLOCKS: 'blocks',\r\n} as const;\r\n","import * as React from 'react';\r\n\r\nexport type UseKeyboardDragAndDropCallbacks<TIndex extends number | Array<number> = number> = {\r\n  onCancel?: (index: TIndex) => void;\r\n  onDropItem?: (currentIndex: TIndex, newIndex?: TIndex) => void;\r\n  onGrabItem?: (index: TIndex) => void;\r\n  onMoveItem?: (newIndex: TIndex, currentIndex: TIndex) => void;\r\n};\r\n\r\n/**\r\n * Utility hook designed to implement keyboard accessibile drag and drop by\r\n * returning an onKeyDown handler to be passed to the drag icon button.\r\n *\r\n * @internal - You should use `useDragAndDrop` instead.\r\n */\r\nexport const useKeyboardDragAndDrop = <TIndex extends number | Array<number> = number>(\r\n  active: boolean,\r\n  index: TIndex,\r\n  { onCancel, onDropItem, onGrabItem, onMoveItem }: UseKeyboardDragAndDropCallbacks<TIndex>\r\n) => {\r\n  const [isSelected, setIsSelected] = React.useState(false);\r\n\r\n  const handleMove = (movement: 'UP' | 'DOWN') => {\r\n    if (!isSelected) {\r\n      return;\r\n    }\r\n    if (typeof index === 'number' && onMoveItem) {\r\n      if (movement === 'UP') {\r\n        onMoveItem((index - 1) as TIndex, index);\r\n      } else if (movement === 'DOWN') {\r\n        onMoveItem((index + 1) as TIndex, index);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleDragClick = () => {\r\n    if (isSelected) {\r\n      if (onDropItem) {\r\n        onDropItem(index);\r\n      }\r\n      setIsSelected(false);\r\n    } else {\r\n      if (onGrabItem) {\r\n        onGrabItem(index);\r\n      }\r\n      setIsSelected(true);\r\n    }\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    if (isSelected) {\r\n      setIsSelected(false);\r\n\r\n      if (onCancel) {\r\n        onCancel(index);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleKeyDown = <E extends Element>(e: React.KeyboardEvent<E>) => {\r\n    if (!active) {\r\n      return;\r\n    }\r\n\r\n    if (e.key === 'Tab' && !isSelected) {\r\n      return;\r\n    }\r\n\r\n    e.preventDefault();\r\n\r\n    switch (e.key) {\r\n      case ' ':\r\n      case 'Enter':\r\n        handleDragClick();\r\n        break;\r\n\r\n      case 'Escape':\r\n        handleCancel();\r\n        break;\r\n\r\n      case 'ArrowDown':\r\n      case 'ArrowRight':\r\n        handleMove('DOWN');\r\n        break;\r\n\r\n      case 'ArrowUp':\r\n      case 'ArrowLeft':\r\n        handleMove('UP');\r\n        break;\r\n\r\n      default:\r\n    }\r\n  };\r\n\r\n  return handleKeyDown;\r\n};\r\n","import * as React from 'react';\r\n\r\nimport {\r\n  useDrag,\r\n  useDrop,\r\n  type HandlerManager,\r\n  type ConnectDragSource,\r\n  type ConnectDropTarget,\r\n  type ConnectDragPreview,\r\n  type DragSourceMonitor,\r\n} from 'react-dnd';\r\n\r\nimport {\r\n  useKeyboardDragAndDrop,\r\n  type UseKeyboardDragAndDropCallbacks,\r\n} from './useKeyboardDragAndDrop';\r\n\r\nimport type { Data } from '@strapi/types';\r\n\r\nconst DIRECTIONS = {\r\n  UPWARD: 'upward',\r\n  DOWNWARD: 'downward',\r\n} as const;\r\n\r\nconst DROP_SENSITIVITY = {\r\n  REGULAR: 'regular',\r\n  IMMEDIATE: 'immediate',\r\n} as const;\r\n\r\ninterface UseDragAndDropOptions<\r\n  TIndex extends number | Array<number> = number,\r\n  TItem extends { index: TIndex } = { index: TIndex },\r\n> extends UseKeyboardDragAndDropCallbacks<TIndex> {\r\n  type?: string;\r\n  index: TIndex;\r\n  item?: TItem;\r\n  onStart?: () => void;\r\n  onEnd?: () => void;\r\n  dropSensitivity?: (typeof DROP_SENSITIVITY)[keyof typeof DROP_SENSITIVITY];\r\n}\r\n\r\ntype Identifier = ReturnType<HandlerManager['getHandlerId']>;\r\n\r\ntype UseDragAndDropReturn<E extends Element = HTMLElement> = [\r\n  props: {\r\n    handlerId: Identifier;\r\n    isDragging: boolean;\r\n    handleKeyDown: <E extends Element>(event: React.KeyboardEvent<E>) => void;\r\n    isOverDropTarget: boolean;\r\n    direction: (typeof DIRECTIONS)[keyof typeof DIRECTIONS] | null;\r\n  },\r\n  objectRef: React.RefObject<E>,\r\n  dropRef: ConnectDropTarget,\r\n  dragRef: ConnectDragSource,\r\n  dragPreviewRef: ConnectDragPreview,\r\n];\r\n\r\ntype DropCollectedProps = {\r\n  handlerId: Identifier;\r\n  isOver: boolean;\r\n};\r\n\r\n/**\r\n * A utility hook abstracting the general drag and drop hooks from react-dnd.\r\n * Centralising the same behaviours and by default offering keyboard support.\r\n */\r\nconst useDragAndDrop = <\r\n  TIndex extends number | Array<number>,\r\n  TItem extends { index: TIndex; id?: Data.ID; [key: string]: unknown } = {\r\n    index: TIndex;\r\n    [key: string]: unknown;\r\n  },\r\n  E extends Element = HTMLElement,\r\n>(\r\n  active: boolean,\r\n  {\r\n    type = 'STRAPI_DND',\r\n    index,\r\n    item,\r\n    onStart,\r\n    onEnd,\r\n    onGrabItem,\r\n    onDropItem,\r\n    onCancel,\r\n    onMoveItem,\r\n    dropSensitivity = DROP_SENSITIVITY.REGULAR,\r\n  }: UseDragAndDropOptions<TIndex, TItem>\r\n): UseDragAndDropReturn<E> => {\r\n  const objectRef = React.useRef<E>(null);\r\n\r\n  const [{ handlerId, isOver }, dropRef] = useDrop<TItem, void, DropCollectedProps>({\r\n    accept: type,\r\n    collect(monitor) {\r\n      return {\r\n        handlerId: monitor.getHandlerId(),\r\n        isOver: monitor.isOver({ shallow: true }),\r\n      };\r\n    },\r\n    drop(item) {\r\n      const draggedIndex = item.index;\r\n      const newIndex = index;\r\n\r\n      if (isOver && onDropItem) {\r\n        onDropItem(draggedIndex, newIndex);\r\n      }\r\n    },\r\n    hover(item, monitor) {\r\n      if (!objectRef.current || !onMoveItem) {\r\n        return;\r\n      }\r\n\r\n      const dragIndex = item.index;\r\n      const newIndex = index;\r\n\r\n      const hoverBoundingRect = objectRef.current?.getBoundingClientRect();\r\n      const hoverMiddleY = (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;\r\n      const clientOffset = monitor.getClientOffset();\r\n      if (!clientOffset) return;\r\n\r\n      const hoverClientY = clientOffset && clientOffset.y - hoverBoundingRect.top;\r\n      if (typeof dragIndex === 'number' && typeof newIndex === 'number') {\r\n        if (dragIndex === newIndex) {\r\n          // Don't replace items with themselves\r\n          return;\r\n        }\r\n\r\n        if (dropSensitivity === DROP_SENSITIVITY.REGULAR) {\r\n          // Dragging downwards\r\n          if (dragIndex < newIndex && hoverClientY < hoverMiddleY) {\r\n            return;\r\n          }\r\n\r\n          // Dragging upwards\r\n          if (dragIndex > newIndex && hoverClientY > hoverMiddleY) {\r\n            return;\r\n          }\r\n        }\r\n\r\n        // Time to actually perform the action\r\n        onMoveItem(newIndex, dragIndex);\r\n        item.index = newIndex;\r\n      } else {\r\n        // Using numbers as indices doesn't work for nested list items with path like [1, 1, 0]\r\n        if (Array.isArray(dragIndex) && Array.isArray(newIndex)) {\r\n          // Indices comparison to find item position in nested list\r\n          const minLength = Math.min(dragIndex.length, newIndex.length);\r\n          let areEqual = true;\r\n          let isLessThan = false;\r\n          let isGreaterThan = false;\r\n\r\n          for (let i = 0; i < minLength; i++) {\r\n            if (dragIndex[i] < newIndex[i]) {\r\n              isLessThan = true;\r\n              areEqual = false;\r\n              break;\r\n            } else if (dragIndex[i] > newIndex[i]) {\r\n              isGreaterThan = true;\r\n              areEqual = false;\r\n              break;\r\n            }\r\n          }\r\n\r\n          // Don't replace items with themselves\r\n          if (areEqual && dragIndex.length === newIndex.length) {\r\n            return;\r\n          }\r\n\r\n          if (dropSensitivity === DROP_SENSITIVITY.REGULAR) {\r\n            // Dragging downwards\r\n            if (isLessThan && !isGreaterThan && hoverClientY < hoverMiddleY) {\r\n              return;\r\n            }\r\n\r\n            // Dragging upwards\r\n            if (isGreaterThan && !isLessThan && hoverClientY > hoverMiddleY) {\r\n              return;\r\n            }\r\n          }\r\n        }\r\n\r\n        onMoveItem(newIndex, dragIndex);\r\n        item.index = newIndex;\r\n      }\r\n    },\r\n  });\r\n\r\n  const getDragDirection = (monitor: DragSourceMonitor<TItem, void>) => {\r\n    if (\r\n      monitor &&\r\n      monitor.isDragging() &&\r\n      !monitor.didDrop() &&\r\n      monitor.getInitialClientOffset() &&\r\n      monitor.getClientOffset()\r\n    ) {\r\n      const deltaY = monitor.getInitialClientOffset()!.y - monitor.getClientOffset()!.y;\r\n\r\n      if (deltaY > 0) return DIRECTIONS.UPWARD;\r\n\r\n      if (deltaY < 0) return DIRECTIONS.DOWNWARD;\r\n\r\n      return null;\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  const [{ isDragging, direction }, dragRef, dragPreviewRef] = useDrag({\r\n    type,\r\n    item() {\r\n      if (onStart) {\r\n        onStart();\r\n      }\r\n\r\n      /**\r\n       * This will be attached and it helps define the preview sizes\r\n       * when a component is flexy e.g. Relations\r\n       */\r\n      const { width } = objectRef.current?.getBoundingClientRect() ?? {};\r\n\r\n      return { index, width, ...item };\r\n    },\r\n    end() {\r\n      if (onEnd) {\r\n        onEnd();\r\n      }\r\n    },\r\n    canDrag: active,\r\n    /**\r\n     * This is useful when the item is in a virtualized list.\r\n     * However, if we don't have an ID then we want the libraries\r\n     * defaults to take care of this.\r\n     */\r\n    isDragging: item?.id\r\n      ? (monitor) => {\r\n          return item.id === monitor.getItem().id;\r\n        }\r\n      : undefined,\r\n    collect: (monitor) => ({\r\n      isDragging: monitor.isDragging(),\r\n      initialOffset: monitor.getInitialClientOffset(),\r\n      currentOffset: monitor.getClientOffset(),\r\n      direction: getDragDirection(monitor),\r\n    }),\r\n  });\r\n\r\n  const handleKeyDown = useKeyboardDragAndDrop(active, index, {\r\n    onGrabItem,\r\n    onDropItem,\r\n    onCancel,\r\n    onMoveItem,\r\n  });\r\n\r\n  return [\r\n    { handlerId, isDragging, handleKeyDown, isOverDropTarget: isOver, direction },\r\n    objectRef,\r\n    dropRef,\r\n    dragRef,\r\n    dragPreviewRef,\r\n  ];\r\n};\r\n\r\nexport {\r\n  useDragAndDrop,\r\n  UseDragAndDropReturn,\r\n  UseDragAndDropOptions,\r\n  DIRECTIONS,\r\n  DROP_SENSITIVITY,\r\n};\r\n"],"names":["React","useDrop","item","useDrag"],"mappings":"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"}