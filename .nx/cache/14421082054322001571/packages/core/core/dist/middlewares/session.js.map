{"version":3,"file":"session.js","sources":["../../src/middlewares/session.ts"],"sourcesContent":["import { isEmpty, isArray } from 'lodash/fp';\r\nimport koaSession from 'koa-session';\r\nimport type { Core } from '@strapi/types';\r\n\r\nconst defaultConfig = {\r\n  key: 'koa.sess',\r\n  maxAge: 86400000,\r\n  autoCommit: true,\r\n  overwrite: true,\r\n  httpOnly: true,\r\n  signed: true,\r\n  rolling: false,\r\n  renew: false,\r\n  secure: process.env.NODE_ENV === 'production',\r\n  sameSite: undefined,\r\n};\r\n\r\nexport const session: Core.MiddlewareFactory<Partial<koaSession.opts>> = (\r\n  userConfig,\r\n  { strapi }\r\n) => {\r\n  const { keys } = strapi.server.app;\r\n  if (!isArray(keys) || isEmpty(keys) || keys.some(isEmpty)) {\r\n    throw new Error(\r\n      `App keys are required. Please set app.keys in config/server.js (ex: keys: ['myKeyA', 'myKeyB'])`\r\n    );\r\n  }\r\n\r\n  const config: Partial<koaSession.opts> = { ...defaultConfig, ...userConfig };\r\n\r\n  strapi.server.use(koaSession(config, strapi.server.app));\r\n};\r\n"],"names":["isArray","isEmpty","koaSession"],"mappings":";;;;;;AAIA,MAAM,gBAAgB;AAAA,EACpB,KAAK;AAAA,EACL,QAAQ;AAAA,EACR,YAAY;AAAA,EACZ,WAAW;AAAA,EACX,UAAU;AAAA,EACV,QAAQ;AAAA,EACR,SAAS;AAAA,EACT,OAAO;AAAA,EACP,QAAQ,QAAQ,IAAI,aAAa;AAAA,EACjC,UAAU;AACZ;AAEO,MAAM,UAA4D,CACvE,YACA,EAAE,aACC;AACH,QAAM,EAAE,KAAA,IAAS,OAAO,OAAO;AAC3B,MAAA,CAACA,GAAAA,QAAQ,IAAI,KAAKC,GAAA,QAAQ,IAAI,KAAK,KAAK,KAAKA,GAAAA,OAAO,GAAG;AACzD,UAAM,IAAI;AAAA,MACR;AAAA,IACF;AAAA,EAAA;AAGF,QAAM,SAAmC,EAAE,GAAG,eAAe,GAAG,WAAW;AAE3E,SAAO,OAAO,IAAIC,oBAAA,QAAW,QAAQ,OAAO,OAAO,GAAG,CAAC;AACzD;;"}