{"version":3,"file":"single-type.js","sources":["../../../src/core-api/service/single-type.ts"],"sourcesContent":["import type { Struct, Core } from '@strapi/types';\r\nimport { CoreService } from './core-service';\r\n\r\nexport class SingleTypeService extends CoreService implements Core.CoreAPI.Service.SingleType {\r\n  private contentType: Struct.SingleTypeSchema;\r\n\r\n  constructor(contentType: Struct.SingleTypeSchema) {\r\n    super();\r\n\r\n    this.contentType = contentType;\r\n  }\r\n\r\n  async getDocumentId() {\r\n    const { uid } = this.contentType;\r\n\r\n    return strapi.db\r\n      .query(uid)\r\n      .findOne()\r\n      .then((document) => document?.documentId as string);\r\n  }\r\n\r\n  async find(params = {}) {\r\n    const { uid } = this.contentType;\r\n\r\n    return strapi.documents(uid).findFirst(this.getFetchParams(params));\r\n  }\r\n\r\n  async createOrUpdate(params = {}) {\r\n    const { uid } = this.contentType;\r\n\r\n    const documentId = await this.getDocumentId();\r\n\r\n    if (documentId) {\r\n      return strapi.documents(uid).update({\r\n        ...this.getFetchParams(params),\r\n        documentId,\r\n      });\r\n    }\r\n\r\n    return strapi.documents(uid).create(this.getFetchParams(params));\r\n  }\r\n\r\n  async delete(params = {}) {\r\n    const { uid } = this.contentType;\r\n\r\n    const documentId = await this.getDocumentId();\r\n    if (!documentId) return { deletedEntries: 0 };\r\n\r\n    const { entries } = await strapi.documents(uid).delete({\r\n      ...this.getFetchParams(params),\r\n      documentId,\r\n    });\r\n\r\n    return { deletedEntries: entries.length };\r\n  }\r\n}\r\n\r\nconst createSingleTypeService = (\r\n  contentType: Struct.SingleTypeSchema\r\n): Core.CoreAPI.Service.SingleType => {\r\n  return new SingleTypeService(contentType);\r\n};\r\n\r\nexport { createSingleTypeService };\r\n"],"names":["CoreService"],"mappings":";;;AAGO,MAAM,0BAA0BA,YAAAA,YAAuD;AAAA,EACpF;AAAA,EAER,YAAY,aAAsC;AAC1C,UAAA;AAEN,SAAK,cAAc;AAAA,EAAA;AAAA,EAGrB,MAAM,gBAAgB;AACd,UAAA,EAAE,QAAQ,KAAK;AAEd,WAAA,OAAO,GACX,MAAM,GAAG,EACT,QAAQ,EACR,KAAK,CAAC,aAAa,UAAU,UAAoB;AAAA,EAAA;AAAA,EAGtD,MAAM,KAAK,SAAS,IAAI;AAChB,UAAA,EAAE,QAAQ,KAAK;AAEd,WAAA,OAAO,UAAU,GAAG,EAAE,UAAU,KAAK,eAAe,MAAM,CAAC;AAAA,EAAA;AAAA,EAGpE,MAAM,eAAe,SAAS,IAAI;AAC1B,UAAA,EAAE,QAAQ,KAAK;AAEf,UAAA,aAAa,MAAM,KAAK,cAAc;AAE5C,QAAI,YAAY;AACd,aAAO,OAAO,UAAU,GAAG,EAAE,OAAO;AAAA,QAClC,GAAG,KAAK,eAAe,MAAM;AAAA,QAC7B;AAAA,MAAA,CACD;AAAA,IAAA;AAGI,WAAA,OAAO,UAAU,GAAG,EAAE,OAAO,KAAK,eAAe,MAAM,CAAC;AAAA,EAAA;AAAA,EAGjE,MAAM,OAAO,SAAS,IAAI;AAClB,UAAA,EAAE,QAAQ,KAAK;AAEf,UAAA,aAAa,MAAM,KAAK,cAAc;AAC5C,QAAI,CAAC,WAAmB,QAAA,EAAE,gBAAgB,EAAE;AAEtC,UAAA,EAAE,YAAY,MAAM,OAAO,UAAU,GAAG,EAAE,OAAO;AAAA,MACrD,GAAG,KAAK,eAAe,MAAM;AAAA,MAC7B;AAAA,IAAA,CACD;AAEM,WAAA,EAAE,gBAAgB,QAAQ,OAAO;AAAA,EAAA;AAE5C;AAEM,MAAA,0BAA0B,CAC9B,gBACoC;AAC7B,SAAA,IAAI,kBAAkB,WAAW;AAC1C;;;"}