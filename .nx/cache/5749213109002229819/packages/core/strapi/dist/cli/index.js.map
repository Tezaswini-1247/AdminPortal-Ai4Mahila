{"version":3,"file":"index.js","sources":["../../src/cli/index.ts"],"sourcesContent":["import { Command } from 'commander';\r\n\r\nimport { commands as strapiCommands } from './commands';\r\n\r\nimport { createLogger } from './utils/logger';\r\nimport { loadTsConfig } from './utils/tsconfig';\r\nimport { CLIContext } from './types';\r\n\r\nconst createCLI = async (argv: string[], command = new Command()) => {\r\n  // Initial program setup\r\n  command.storeOptionsAsProperties(false).allowUnknownOption(true);\r\n\r\n  // Help command\r\n  command.helpOption('-h, --help', 'Display help for command');\r\n  command.addHelpCommand('help [command]', 'Display help for command');\r\n\r\n  command.version(\r\n    // eslint-disable-next-line @typescript-eslint/no-var-requires\r\n    require('../../package.json').version,\r\n    '-v, --version',\r\n    'Output the version number'\r\n  );\r\n\r\n  const cwd = process.cwd();\r\n\r\n  const hasDebug = argv.includes('--debug');\r\n  const hasSilent = argv.includes('--silent');\r\n\r\n  const logger = createLogger({ debug: hasDebug, silent: hasSilent, timestamp: false });\r\n\r\n  const tsconfig = loadTsConfig({\r\n    cwd,\r\n    path: 'tsconfig.json',\r\n    logger,\r\n  });\r\n\r\n  const ctx = {\r\n    cwd,\r\n    logger,\r\n    tsconfig,\r\n  } satisfies CLIContext;\r\n\r\n  // Load all commands\r\n  for (const commandFactory of strapiCommands) {\r\n    try {\r\n      const subCommand = await commandFactory({ command, argv, ctx });\r\n\r\n      // Add this command to the Commander command object\r\n      if (subCommand) {\r\n        command.addCommand(subCommand);\r\n      }\r\n    } catch (e) {\r\n      console.error(`Failed to load command`, e);\r\n    }\r\n  }\r\n\r\n  // TODO v6: remove these deprecation notices\r\n  const deprecatedCommands = [\r\n    { name: 'plugin:init', message: 'Please use `npx @strapi/sdk-plugin init` instead.' },\r\n    {\r\n      name: 'plugin:verify',\r\n      message: 'After migrating your plugin to v5, use `strapi-plugin verify`',\r\n    },\r\n    {\r\n      name: 'plugin:watch',\r\n      message: 'After migrating your plugin to v5, use `strapi-plugin watch`',\r\n    },\r\n    {\r\n      name: 'plugin:watch:link',\r\n      message: 'After migrating your plugin to v5, use `strapi-plugin watch:link`',\r\n    },\r\n    {\r\n      name: 'plugin:build',\r\n      message: 'After migrating your plugin to v5, use `strapi-plugin build`',\r\n    },\r\n  ];\r\n\r\n  // Add hidden commands for deprecatedCommands that output a warning that the command has been removed.\r\n  deprecatedCommands.forEach(({ name, message }) => {\r\n    const deprecated = new Command(name)\r\n      .command(name)\r\n      .description('(deprecated)')\r\n      .action(() => {\r\n        console.warn(\r\n          `The command ${name} has been deprecated. See the Strapi 5 migration guide for more information.`\r\n        );\r\n        if (message) {\r\n          console.warn(message);\r\n        }\r\n      });\r\n    command.addCommand(deprecated, { hidden: true });\r\n  });\r\n  return command;\r\n};\r\n\r\nconst runCLI = async (argv = process.argv, command = new Command()) => {\r\n  const commands = await createCLI(argv, command);\r\n  await commands.parseAsync(argv);\r\n};\r\n\r\nexport { runCLI, createCLI };\r\n"],"names":["Command","logger","createLogger","tsconfig","loadTsConfig","strapiCommands"],"mappings":";;;;;;AAQA,MAAM,YAAY,OAAO,MAAgB,UAAU,IAAIA,wBAAc;AAEnE,UAAQ,yBAAyB,KAAK,EAAE,mBAAmB,IAAI;AAGvD,UAAA,WAAW,cAAc,0BAA0B;AACnD,UAAA,eAAe,kBAAkB,0BAA0B;AAE3D,UAAA;AAAA;AAAA,IAEN,QAAQ,oBAAoB,EAAE;AAAA,IAC9B;AAAA,IACA;AAAA,EACF;AAEM,QAAA,MAAM,QAAQ,IAAI;AAElB,QAAA,WAAW,KAAK,SAAS,SAAS;AAClC,QAAA,YAAY,KAAK,SAAS,UAAU;AAEpC,QAAAC,WAASC,oBAAa,EAAE,OAAO,UAAU,QAAQ,WAAW,WAAW,OAAO;AAEpF,QAAMC,aAAWC,SAAAA,aAAa;AAAA,IAC5B;AAAA,IACA,MAAM;AAAA,IACNH,QAAAA;AAAAA,EAAA,CACD;AAED,QAAM,MAAM;AAAA,IACV;AAAA,IAAA,QACAA;AAAAA,IACAE,UAAAA;AAAAA,EACF;AAGA,aAAW,kBAAkBE,gBAAgB;AACvC,QAAA;AACF,YAAM,aAAa,MAAM,eAAe,EAAE,SAAS,MAAM,KAAK;AAG9D,UAAI,YAAY;AACd,gBAAQ,WAAW,UAAU;AAAA,MAAA;AAAA,aAExB,GAAG;AACF,cAAA,MAAM,0BAA0B,CAAC;AAAA,IAAA;AAAA,EAC3C;AAIF,QAAM,qBAAqB;AAAA,IACzB,EAAE,MAAM,eAAe,SAAS,oDAAoD;AAAA,IACpF;AAAA,MACE,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,SAAS;AAAA,IAAA;AAAA,EAEb;AAGA,qBAAmB,QAAQ,CAAC,EAAE,MAAM,cAAc;AAChD,UAAM,aAAa,IAAIL,kBAAQ,IAAI,EAChC,QAAQ,IAAI,EACZ,YAAY,cAAc,EAC1B,OAAO,MAAM;AACJ,cAAA;AAAA,QACN,eAAe,IAAI;AAAA,MACrB;AACA,UAAI,SAAS;AACX,gBAAQ,KAAK,OAAO;AAAA,MAAA;AAAA,IACtB,CACD;AACH,YAAQ,WAAW,YAAY,EAAE,QAAQ,MAAM;AAAA,EAAA,CAChD;AACM,SAAA;AACT;AAEM,MAAA,SAAS,OAAO,OAAO,QAAQ,MAAM,UAAU,IAAIA,UAAAA,cAAc;AACrE,QAAM,WAAW,MAAM,UAAU,MAAM,OAAO;AACxC,QAAA,SAAS,WAAW,IAAI;AAChC;;;"}