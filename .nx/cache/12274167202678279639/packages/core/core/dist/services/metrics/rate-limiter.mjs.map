{"version":3,"file":"rate-limiter.mjs","sources":["../../../src/services/metrics/rate-limiter.ts"],"sourcesContent":["import type { Sender } from './sender';\r\n\r\ninterface Options {\r\n  limitedEvents?: string[];\r\n}\r\n\r\ntype TailParams<T extends (...args: any[]) => any> =\r\n  Parameters<T> extends [unknown, ...infer U] ? U : never;\r\n\r\nexport default (sender: Sender, { limitedEvents = [] }: Options = {}) => {\r\n  let currentDay = new Date().getDate();\r\n  const eventCache = new Map();\r\n\r\n  return async (event: string, ...args: TailParams<Sender>) => {\r\n    if (!limitedEvents.includes(event)) {\r\n      return sender(event, ...args);\r\n    }\r\n\r\n    if (new Date().getDate() !== currentDay) {\r\n      eventCache.clear();\r\n      currentDay = new Date().getDate();\r\n    }\r\n\r\n    if (eventCache.has(event)) {\r\n      return false;\r\n    }\r\n\r\n    eventCache.set(event, true);\r\n    return sender(event, ...args);\r\n  };\r\n};\r\n"],"names":[],"mappings":"AASA,MAAe,oBAAA,CAAC,QAAgB,EAAE,gBAAgB,CAAG,EAAA,IAAa,CAAA,MAAO;AACvE,MAAI,cAAa,oBAAI,KAAK,GAAE,QAAQ;AAC9B,QAAA,iCAAiB,IAAI;AAEpB,SAAA,OAAO,UAAkB,SAA6B;AAC3D,QAAI,CAAC,cAAc,SAAS,KAAK,GAAG;AAC3B,aAAA,OAAO,OAAO,GAAG,IAAI;AAAA,IAAA;AAG9B,SAAQ,oBAAA,KAAA,GAAO,QAAA,MAAc,YAAY;AACvC,iBAAW,MAAM;AACJ,oBAAA,oBAAI,KAAK,GAAE,QAAQ;AAAA,IAAA;AAG9B,QAAA,WAAW,IAAI,KAAK,GAAG;AAClB,aAAA;AAAA,IAAA;AAGE,eAAA,IAAI,OAAO,IAAI;AACnB,WAAA,OAAO,OAAO,GAAG,IAAI;AAAA,EAC9B;AACF;"}