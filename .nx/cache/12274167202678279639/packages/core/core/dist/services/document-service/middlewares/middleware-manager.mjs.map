{"version":3,"file":"middleware-manager.mjs","sources":["../../../../src/services/document-service/middlewares/middleware-manager.ts"],"sourcesContent":["export type Middleware = (ctx: any, next: () => Promise<void>) => Promise<void> | void;\r\n\r\nexport type Options = {\r\n  exclude?: string[];\r\n};\r\n\r\nexport const createMiddlewareManager = () => {\r\n  const middlewares: Middleware[] = [];\r\n\r\n  const manager = {\r\n    use(middleware: Middleware) {\r\n      middlewares.push(middleware);\r\n\r\n      return () => middlewares.splice(middlewares.indexOf(middleware), 1);\r\n    },\r\n\r\n    async run(ctx: any, cb: () => void) {\r\n      let index = 0;\r\n      const next = async () => {\r\n        if (index < middlewares.length) {\r\n          // eslint-disable-next-line no-plusplus\r\n          return middlewares[index++](ctx, next);\r\n        }\r\n\r\n        return cb();\r\n      };\r\n\r\n      return next();\r\n    },\r\n\r\n    wrapObject<TSource>(source: TSource, ctxDefaults = {}, opts: Options = {}): TSource {\r\n      const facade: TSource = {} as TSource;\r\n      const { exclude = [] } = opts;\r\n\r\n      for (const key in source) {\r\n        if (Object.hasOwnProperty.call(source, key)) {\r\n          const prop = source[key];\r\n\r\n          if (exclude.includes(key)) {\r\n            facade[key] = prop;\r\n          } else if (typeof prop === 'function') {\r\n            const newMethod = async (params: any = {}) => {\r\n              const ctx = {\r\n                ...ctxDefaults,\r\n                action: key,\r\n                params,\r\n              };\r\n\r\n              return manager.run(ctx, () => prop(ctx.params));\r\n            };\r\n\r\n            facade[key] = newMethod as typeof prop;\r\n          } else {\r\n            facade[key] = prop;\r\n          }\r\n        }\r\n      }\r\n\r\n      return facade;\r\n    },\r\n  };\r\n\r\n  return manager;\r\n};\r\n"],"names":[],"mappings":"AAMO,MAAM,0BAA0B,MAAM;AAC3C,QAAM,cAA4B,CAAC;AAEnC,QAAM,UAAU;AAAA,IACd,IAAI,YAAwB;AAC1B,kBAAY,KAAK,UAAU;AAE3B,aAAO,MAAM,YAAY,OAAO,YAAY,QAAQ,UAAU,GAAG,CAAC;AAAA,IACpE;AAAA,IAEA,MAAM,IAAI,KAAU,IAAgB;AAClC,UAAI,QAAQ;AACZ,YAAM,OAAO,YAAY;AACnB,YAAA,QAAQ,YAAY,QAAQ;AAE9B,iBAAO,YAAY,OAAO,EAAE,KAAK,IAAI;AAAA,QAAA;AAGvC,eAAO,GAAG;AAAA,MACZ;AAEA,aAAO,KAAK;AAAA,IACd;AAAA,IAEA,WAAoB,QAAiB,cAAc,CAAA,GAAI,OAAgB,CAAA,GAAa;AAClF,YAAM,SAAkB,CAAC;AACzB,YAAM,EAAE,UAAU,CAAC,EAAA,IAAM;AAEzB,iBAAW,OAAO,QAAQ;AACxB,YAAI,OAAO,eAAe,KAAK,QAAQ,GAAG,GAAG;AACrC,gBAAA,OAAO,OAAO,GAAG;AAEnB,cAAA,QAAQ,SAAS,GAAG,GAAG;AACzB,mBAAO,GAAG,IAAI;AAAA,UAAA,WACL,OAAO,SAAS,YAAY;AACrC,kBAAM,YAAY,OAAO,SAAc,OAAO;AAC5C,oBAAM,MAAM;AAAA,gBACV,GAAG;AAAA,gBACH,QAAQ;AAAA,gBACR;AAAA,cACF;AAEA,qBAAO,QAAQ,IAAI,KAAK,MAAM,KAAK,IAAI,MAAM,CAAC;AAAA,YAChD;AAEA,mBAAO,GAAG,IAAI;AAAA,UAAA,OACT;AACL,mBAAO,GAAG,IAAI;AAAA,UAAA;AAAA,QAChB;AAAA,MACF;AAGK,aAAA;AAAA,IAAA;AAAA,EAEX;AAEO,SAAA;AACT;"}