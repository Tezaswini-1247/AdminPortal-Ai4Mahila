{"version":3,"file":"id-transform.mjs","sources":["../../../../src/services/document-service/transform/id-transform.ts"],"sourcesContent":["import { curry } from 'lodash/fp';\r\n\r\nimport { UID, Modules } from '@strapi/types';\r\n\r\nimport { transformData } from './data';\r\nimport { transformFields } from './fields';\r\nimport { transformPopulate } from './populate';\r\n\r\n/**\r\n * Transform input of a query to map document ids to entity ids.\r\n */\r\nasync function transformParamsDocumentId(\r\n  uid: UID.Schema,\r\n  query: Modules.Documents.Params.All\r\n): Promise<Modules.Documents.Params.All> {\r\n  // Transform relational documentIds to entity ids\r\n  let data = query.data;\r\n  if (query.data) {\r\n    data = await transformData(query.data, {\r\n      locale: query.locale,\r\n      status: query.status,\r\n      uid,\r\n    });\r\n  }\r\n\r\n  // Make sure documentId is always present in the response\r\n  let fields = query.fields;\r\n  if (query.fields) {\r\n    fields = transformFields(query.fields) as typeof query.fields;\r\n  }\r\n\r\n  let populate = query.populate;\r\n  if (query.populate) {\r\n    populate = (await transformPopulate(query.populate, { uid })) as typeof query.populate;\r\n  }\r\n\r\n  return {\r\n    ...query,\r\n    data,\r\n    fields,\r\n    populate,\r\n  };\r\n}\r\n\r\nconst curriedTransformParamsDocumentId = curry(transformParamsDocumentId);\r\n\r\nexport { curriedTransformParamsDocumentId as transformParamsDocumentId };\r\n"],"names":[],"mappings":";;;;AAWA,eAAe,0BACb,KACA,OACuC;AAEvC,MAAI,OAAO,MAAM;AACjB,MAAI,MAAM,MAAM;AACP,WAAA,MAAM,cAAc,MAAM,MAAM;AAAA,MACrC,QAAQ,MAAM;AAAA,MACd,QAAQ,MAAM;AAAA,MACd;AAAA,IAAA,CACD;AAAA,EAAA;AAIH,MAAI,SAAS,MAAM;AACnB,MAAI,MAAM,QAAQ;AACP,aAAA,gBAAgB,MAAM,MAAM;AAAA,EAAA;AAGvC,MAAI,WAAW,MAAM;AACrB,MAAI,MAAM,UAAU;AAClB,eAAY,MAAM,kBAAkB,MAAM,UAAU,EAAE,KAAK;AAAA,EAAA;AAGtD,SAAA;AAAA,IACL,GAAG;AAAA,IACH;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACF;AAEM,MAAA,mCAAmC,MAAM,yBAAyB;"}