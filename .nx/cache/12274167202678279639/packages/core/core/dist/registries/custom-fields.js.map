{"version":3,"file":"custom-fields.js","sources":["../../src/registries/custom-fields.ts"],"sourcesContent":["import { has, isPlainObject } from 'lodash/fp';\r\n\r\nimport type { Core, Modules } from '@strapi/types';\r\n\r\nconst ALLOWED_TYPES = [\r\n  'biginteger',\r\n  'boolean',\r\n  'date',\r\n  'datetime',\r\n  'decimal',\r\n  'email',\r\n  'enumeration',\r\n  'float',\r\n  'integer',\r\n  'json',\r\n  'password',\r\n  'richtext',\r\n  'string',\r\n  'text',\r\n  'time',\r\n  'uid',\r\n] as const;\r\n\r\nconst customFieldsRegistry = (strapi: Core.Strapi) => {\r\n  const customFields: Record<string, unknown> = {};\r\n\r\n  return {\r\n    getAll() {\r\n      return customFields;\r\n    },\r\n    get(customField: string) {\r\n      const registeredCustomField = customFields[customField];\r\n      if (!registeredCustomField) {\r\n        throw new Error(`Could not find Custom Field: ${customField}`);\r\n      }\r\n\r\n      return registeredCustomField;\r\n    },\r\n    add(\r\n      customField:\r\n        | Modules.CustomFields.CustomFieldServerOptions\r\n        | Modules.CustomFields.CustomFieldServerOptions[]\r\n    ) {\r\n      const customFieldList = Array.isArray(customField) ? customField : [customField];\r\n\r\n      for (const cf of customFieldList) {\r\n        if (!has('name', cf) || !has('type', cf)) {\r\n          throw new Error(`Custom fields require a 'name' and 'type' key`);\r\n        }\r\n\r\n        const { name, plugin, type, inputSize } = cf;\r\n        if (!ALLOWED_TYPES.includes(type)) {\r\n          throw new Error(\r\n            `Custom field type: '${type}' is not a valid Strapi type or it can't be used with a Custom Field`\r\n          );\r\n        }\r\n\r\n        const isValidObjectKey = /^(?![0-9])[a-zA-Z0-9$_-]+$/g;\r\n        if (!isValidObjectKey.test(name)) {\r\n          throw new Error(`Custom field name: '${name}' is not a valid object key`);\r\n        }\r\n\r\n        // Validate inputSize when provided\r\n        if (inputSize) {\r\n          if (\r\n            !isPlainObject(inputSize) ||\r\n            !has('default', inputSize) ||\r\n            !has('isResizable', inputSize)\r\n          ) {\r\n            throw new Error(`inputSize should be an object with 'default' and 'isResizable' keys`);\r\n          }\r\n          if (![4, 6, 8, 12].includes(inputSize.default)) {\r\n            throw new Error('Custom fields require a valid default input size');\r\n          }\r\n          if (typeof inputSize.isResizable !== 'boolean') {\r\n            throw new Error('Custom fields should specify if their input is resizable');\r\n          }\r\n        }\r\n\r\n        // When no plugin is specified, or it isn't found in Strapi, default to global\r\n        const uid =\r\n          plugin && strapi.plugin(plugin) ? `plugin::${plugin}.${name}` : `global::${name}`;\r\n\r\n        if (has(uid, customFields)) {\r\n          throw new Error(`Custom field: '${uid}' has already been registered`);\r\n        }\r\n\r\n        customFields[uid] = cf;\r\n      }\r\n    },\r\n  };\r\n};\r\n\r\nexport default customFieldsRegistry;\r\n"],"names":["has","isPlainObject"],"mappings":";;AAIA,MAAM,gBAAgB;AAAA,EACpB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;AAEM,MAAA,uBAAuB,CAAC,WAAwB;AACpD,QAAM,eAAwC,CAAC;AAExC,SAAA;AAAA,IACL,SAAS;AACA,aAAA;AAAA,IACT;AAAA,IACA,IAAI,aAAqB;AACjB,YAAA,wBAAwB,aAAa,WAAW;AACtD,UAAI,CAAC,uBAAuB;AAC1B,cAAM,IAAI,MAAM,gCAAgC,WAAW,EAAE;AAAA,MAAA;AAGxD,aAAA;AAAA,IACT;AAAA,IACA,IACE,aAGA;AACA,YAAM,kBAAkB,MAAM,QAAQ,WAAW,IAAI,cAAc,CAAC,WAAW;AAE/E,iBAAW,MAAM,iBAAiB;AAC5B,YAAA,CAACA,GAAAA,IAAI,QAAQ,EAAE,KAAK,CAACA,OAAI,QAAQ,EAAE,GAAG;AAClC,gBAAA,IAAI,MAAM,+CAA+C;AAAA,QAAA;AAGjE,cAAM,EAAE,MAAM,QAAQ,MAAM,UAAc,IAAA;AAC1C,YAAI,CAAC,cAAc,SAAS,IAAI,GAAG;AACjC,gBAAM,IAAI;AAAA,YACR,uBAAuB,IAAI;AAAA,UAC7B;AAAA,QAAA;AAGF,cAAM,mBAAmB;AACzB,YAAI,CAAC,iBAAiB,KAAK,IAAI,GAAG;AAChC,gBAAM,IAAI,MAAM,uBAAuB,IAAI,6BAA6B;AAAA,QAAA;AAI1E,YAAI,WAAW;AACb,cACE,CAACC,GAAA,cAAc,SAAS,KACxB,CAACD,GAAAA,IAAI,WAAW,SAAS,KACzB,CAACA,GAAAA,IAAI,eAAe,SAAS,GAC7B;AACM,kBAAA,IAAI,MAAM,qEAAqE;AAAA,UAAA;AAEnF,cAAA,CAAC,CAAC,GAAG,GAAG,GAAG,EAAE,EAAE,SAAS,UAAU,OAAO,GAAG;AACxC,kBAAA,IAAI,MAAM,kDAAkD;AAAA,UAAA;AAEhE,cAAA,OAAO,UAAU,gBAAgB,WAAW;AACxC,kBAAA,IAAI,MAAM,0DAA0D;AAAA,UAAA;AAAA,QAC5E;AAIF,cAAM,MACJ,UAAU,OAAO,OAAO,MAAM,IAAI,WAAW,MAAM,IAAI,IAAI,KAAK,WAAW,IAAI;AAE7E,YAAAA,GAAA,IAAI,KAAK,YAAY,GAAG;AAC1B,gBAAM,IAAI,MAAM,kBAAkB,GAAG,+BAA+B;AAAA,QAAA;AAGtE,qBAAa,GAAG,IAAI;AAAA,MAAA;AAAA,IACtB;AAAA,EAEJ;AACF;;"}